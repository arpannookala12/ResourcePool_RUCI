<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.5.57">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>HPS Binary Classification Model</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = '/';
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
     <script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>  
        <link rel="stylesheet" href="styles.css">
      </head>

  <body class="floating nav-fixed quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link"><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> HPS Binary Classification Model</h6>

            <a href="./hps_cps_pums.ipynb" class="btn btn-primary quarto-download-embed" download="hps_cps_pums.ipynb">Download Notebook</a>
          </div>

     <div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">RUCI LAB</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./datadict.html"> 
<span class="menu-text">Data Dictionary (CDC, EPA, USGS)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./eda.html"> 
<span class="menu-text">EDA for HPS data</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cps-binary-classification-model" id="toc-cps-binary-classification-model" class="nav-link active" data-scroll-target="#cps-binary-classification-model">CPS Binary Classification Model</a></li>
  <li><a href="#pums-classification-model" id="toc-pums-classification-model" class="nav-link" data-scroll-target="#pums-classification-model">PUMS Classification model</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">      <header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HPS Binary Classification Model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>     <div id="cell-1" class="cell markdown">

</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score, confusion_matrix, roc_auc_score</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> RFECV, SelectKBest, mutual_info_classif</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> parallel_backend</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max_columns"</span>,<span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> pd.read_csv(<span class="st">"/content/combinedphase4hps.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> filtered_df.drop([<span class="st">'Unnamed: 0'</span>,<span class="st">'PWEIGHT'</span>, <span class="st">'HWEIGHT'</span>, <span class="st">'SCRAM'</span>, <span class="st">'TWDAYS'</span>,<span class="st">'TWDAYS_RESP'</span>,<span class="st">'AHHLD_NUMPER'</span>,<span class="st">'AHHLD_NUMKID'</span>,<span class="st">'ABIRTH_YEAR'</span>,<span class="st">'AEDUC'</span>,<span class="st">'ARACE'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> filtered_df[<span class="st">'TWDAYS_RESP'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div id="cell-5" class="cell" data-outputid="fec272e8-f55d-42a2-fc1a-5a9c856843ad">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

  <div id="df-d3b2c971-8e2e-4d08-bc31-aa9f3fc4d242" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CYCLE</th>
<th data-quarto-table-cell-role="th">EST_ST</th>
<th data-quarto-table-cell-role="th">REGION</th>
<th data-quarto-table-cell-role="th">RHISPANIC</th>
<th data-quarto-table-cell-role="th">AHISPANIC</th>
<th data-quarto-table-cell-role="th">RRACE</th>
<th data-quarto-table-cell-role="th">EEDUC</th>
<th data-quarto-table-cell-role="th">MS</th>
<th data-quarto-table-cell-role="th">EGENID_BIRTH</th>
<th data-quarto-table-cell-role="th">AGENID_BIRTH</th>
<th data-quarto-table-cell-role="th">THHLD_NUMPER</th>
<th data-quarto-table-cell-role="th">THHLD_NUMKID</th>
<th data-quarto-table-cell-role="th">THHLD_NUMADLT</th>
<th data-quarto-table-cell-role="th">ACTVDUTY1</th>
<th data-quarto-table-cell-role="th">RECVDVACC</th>
<th data-quarto-table-cell-role="th">HADCOVIDRV</th>
<th data-quarto-table-cell-role="th">WRKLOSSRV</th>
<th data-quarto-table-cell-role="th">ANYWORK</th>
<th data-quarto-table-cell-role="th">KINDWORK</th>
<th data-quarto-table-cell-role="th">EXPNS_DIF</th>
<th data-quarto-table-cell-role="th">CURFOODSUF</th>
<th data-quarto-table-cell-role="th">FREEFOOD</th>
<th data-quarto-table-cell-role="th">ANXIOUS</th>
<th data-quarto-table-cell-role="th">WORRY</th>
<th data-quarto-table-cell-role="th">INTEREST</th>
<th data-quarto-table-cell-role="th">DOWN</th>
<th data-quarto-table-cell-role="th">PRIVHLTH</th>
<th data-quarto-table-cell-role="th">PUBHLTH</th>
<th data-quarto-table-cell-role="th">SEEING</th>
<th data-quarto-table-cell-role="th">HEARING</th>
<th data-quarto-table-cell-role="th">REMEMBERING</th>
<th data-quarto-table-cell-role="th">MOBILITY</th>
<th data-quarto-table-cell-role="th">SELFCARE</th>
<th data-quarto-table-cell-role="th">UNDERSTAND</th>
<th data-quarto-table-cell-role="th">TENURE</th>
<th data-quarto-table-cell-role="th">LIVQTRRV</th>
<th data-quarto-table-cell-role="th">ENERGY</th>
<th data-quarto-table-cell-role="th">HSE_TEMP</th>
<th data-quarto-table-cell-role="th">ENRGY_BILL</th>
<th data-quarto-table-cell-role="th">INCOME</th>
<th data-quarto-table-cell-role="th">PRICECHNG</th>
<th data-quarto-table-cell-role="th">PRICECONCRN</th>
<th data-quarto-table-cell-role="th">ND_DISPLACE</th>
<th data-quarto-table-cell-role="th">VETERAN1</th>
<th data-quarto-table-cell-role="th">SOCIAL1</th>
<th data-quarto-table-cell-role="th">SOCIAL2</th>
<th data-quarto-table-cell-role="th">SUPPORT1</th>
<th data-quarto-table-cell-role="th">SUPPORT2</th>
<th data-quarto-table-cell-role="th">SUPPORT3</th>
<th data-quarto-table-cell-role="th">AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>36.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>6.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>55.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>34.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>6.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>28.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>36.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>6.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>5.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>49.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>34.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>7.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>8.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>50.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.0</td>
<td>36.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>6.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>7.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>30.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5660</td>
<td>9.0</td>
<td>34.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>8.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>49.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5661</td>
<td>9.0</td>
<td>36.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>7.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>8.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>2.0</td>
<td>3.0</td>
<td>42.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5662</td>
<td>9.0</td>
<td>36.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>7.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>8.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>33.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5663</td>
<td>9.0</td>
<td>34.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>55.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5664</td>
<td>9.0</td>
<td>36.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>6.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>0.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>1.0</td>
<td>27.0</td>
</tr>
</tbody>
</table>

<p>5665 rows Ã— 50 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-d3b2c971-8e2e-4d08-bc31-aa9f3fc4d242')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-d3b2c971-8e2e-4d08-bc31-aa9f3fc4d242 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-d3b2c971-8e2e-4d08-bc31-aa9f3fc4d242');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-ea2190d5-2538-4656-a6fa-1df60136d9d6">
  <button class="colab-df-quickchart" onclick="quickchart('df-ea2190d5-2538-4656-a6fa-1df60136d9d6')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-ea2190d5-2538-4656-a6fa-1df60136d9d6 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_2d7eef03-53b5-4d28-ae21-2fd76f0fde40">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('X')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_2d7eef03-53b5-4d28-ae21-2fd76f0fde40 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('X');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert labels from 1.0/2.0 to 0/1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> (y <span class="op">==</span> <span class="fl">2.0</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-7" class="cell" data-outputid="3ca4dd42-970e-49fa-d435-53ffed654399">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing initial feature selection..."</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>selector <span class="op">=</span> SelectKBest(mutual_info_classif, k<span class="op">=</span><span class="dv">50</span>)  <span class="co"># Keep top 50 features</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>X_reduced <span class="op">=</span> selector.fit_transform(X, y)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> X.columns[selector.get_support(indices<span class="op">=</span><span class="va">True</span>)]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 50 features selected."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing initial feature selection...
Top 50 features selected.</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-8" class="cell" data-outputid="c6671258-b85e-4002-c34d-52bb500a9984">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with reduced features for VIF and further steps</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(X_reduced, columns<span class="op">=</span>selected_features)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_vif(df):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    vif_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    vif_data[<span class="st">"Feature"</span>] <span class="op">=</span> df.columns</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    vif_data[<span class="st">"VIF"</span>] <span class="op">=</span> [variance_inflation_factor(df.values, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df.shape[<span class="dv">1</span>])]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vif_data</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIF for all features</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing multicollinearity analysis..."</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>vif_data <span class="op">=</span> calculate_vif(X)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VIF Results:"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vif_data)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop features with high VIF (&gt;10)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>high_vif_features <span class="op">=</span> vif_data[vif_data[<span class="st">"VIF"</span>] <span class="op">&gt;</span> <span class="dv">15</span>][<span class="st">"Feature"</span>].tolist()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dropping features with high VIF: </span><span class="sc">{</span>high_vif_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop(columns<span class="op">=</span>high_vif_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing multicollinearity analysis...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/statsmodels/regression/linear_model.py:1782: RuntimeWarning: divide by zero encountered in scalar divide
  return 1 - self.ssr/self.centered_tss
/usr/local/lib/python3.11/dist-packages/statsmodels/stats/outliers_influence.py:197: RuntimeWarning: divide by zero encountered in scalar divide
  vif = 1. / (1. - r_squared_i)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VIF Results:
          Feature       VIF
0           CYCLE  1.017447
1          EST_ST  1.177024
2          REGION  0.000000
3       RHISPANIC  1.042880
4       AHISPANIC  1.004881
5           RRACE  1.078979
6           EEDUC  1.222808
7              MS  1.753173
8    EGENID_BIRTH  1.112458
9    AGENID_BIRTH  1.011530
10   THHLD_NUMPER       inf
11   THHLD_NUMKID       inf
12  THHLD_NUMADLT       inf
13      ACTVDUTY1  0.000000
14      RECVDVACC  1.068647
15     HADCOVIDRV  1.041604
16      WRKLOSSRV  1.048995
17        ANYWORK  0.000000
18       KINDWORK  1.110101
19      EXPNS_DIF  2.112060
20     CURFOODSUF  1.742856
21       FREEFOOD  1.055199
22        ANXIOUS  2.953812
23          WORRY  2.912706
24       INTEREST  2.490250
25           DOWN  2.924415
26       PRIVHLTH  1.254752
27        PUBHLTH  1.224917
28         SEEING  1.174728
29        HEARING  1.139989
30    REMEMBERING  1.370348
31       MOBILITY  1.233866
32       SELFCARE  1.274685
33     UNDERSTAND  1.213315
34         TENURE  1.668701
35       LIVQTRRV  1.898722
36         ENERGY  1.902153
37       HSE_TEMP  1.230725
38     ENRGY_BILL  1.621682
39         INCOME  1.693776
40      PRICECHNG  1.231449
41    PRICECONCRN  1.629774
42    ND_DISPLACE  1.017538
43       VETERAN1  0.000000
44        SOCIAL1  1.384256
45        SOCIAL2  1.625487
46       SUPPORT1  1.204116
47       SUPPORT2  1.235698
48       SUPPORT3  1.128506
49            AGE  1.693441
Dropping features with high VIF: ['THHLD_NUMPER', 'THHLD_NUMKID', 'THHLD_NUMADLT']</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div id="cell-10" class="cell" data-outputid="7b055e0f-f07e-4ccb-a5f7-aff5d635321e">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive Feature Elimination</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing Recursive Feature Elimination..."</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> parallel_backend(<span class="st">'threading'</span>):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    rf_model <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    rfecv <span class="op">=</span> RFECV(estimator<span class="op">=</span>rf_model, step<span class="op">=</span><span class="dv">1</span>, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    rfecv.fit(X_train, y_train)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get selected features from RFE</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>rfe_selected_features <span class="op">=</span> rfecv.support_</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>X_train_final <span class="op">=</span> X_train.iloc[:, rfe_selected_features]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>X_test_final <span class="op">=</span> X_test.iloc[:, rfe_selected_features]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing Recursive Feature Elimination...</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Outlier Analysis</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Performing outlier analysis...")</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z_scores = np.abs((X_train_final - np.mean(X_train_final, axis=0)) / np.std(X_train_final, axis=0))</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = 3</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># non_outliers = (z_scores &lt; threshold).all(axis=1)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># outlier_percentage = 100 * (1 - np.sum(non_outliers) / len(non_outliers))</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Percentage of outliers removed: {outlier_percentage:.2f}%")</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_final = X_train_final[non_outliers]</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train = y_train[non_outliers]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-12" class="cell" data-outputid="4bea4bde-c935-4fee-e23d-68c28e4193e6">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X_train_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

  <div id="df-434307d0-a484-4f52-8811-ab38cf7489bc" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CYCLE</th>
<th data-quarto-table-cell-role="th">EST_ST</th>
<th data-quarto-table-cell-role="th">RRACE</th>
<th data-quarto-table-cell-role="th">EEDUC</th>
<th data-quarto-table-cell-role="th">MS</th>
<th data-quarto-table-cell-role="th">EGENID_BIRTH</th>
<th data-quarto-table-cell-role="th">HADCOVIDRV</th>
<th data-quarto-table-cell-role="th">KINDWORK</th>
<th data-quarto-table-cell-role="th">EXPNS_DIF</th>
<th data-quarto-table-cell-role="th">CURFOODSUF</th>
<th data-quarto-table-cell-role="th">ANXIOUS</th>
<th data-quarto-table-cell-role="th">WORRY</th>
<th data-quarto-table-cell-role="th">INTEREST</th>
<th data-quarto-table-cell-role="th">DOWN</th>
<th data-quarto-table-cell-role="th">PUBHLTH</th>
<th data-quarto-table-cell-role="th">SEEING</th>
<th data-quarto-table-cell-role="th">REMEMBERING</th>
<th data-quarto-table-cell-role="th">TENURE</th>
<th data-quarto-table-cell-role="th">LIVQTRRV</th>
<th data-quarto-table-cell-role="th">ENERGY</th>
<th data-quarto-table-cell-role="th">INCOME</th>
<th data-quarto-table-cell-role="th">PRICECHNG</th>
<th data-quarto-table-cell-role="th">PRICECONCRN</th>
<th data-quarto-table-cell-role="th">SOCIAL1</th>
<th data-quarto-table-cell-role="th">SOCIAL2</th>
<th data-quarto-table-cell-role="th">SUPPORT1</th>
<th data-quarto-table-cell-role="th">SUPPORT2</th>
<th data-quarto-table-cell-role="th">SUPPORT3</th>
<th data-quarto-table-cell-role="th">AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2128</td>
<td>4.0</td>
<td>34.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>6.0</td>
<td>2.0</td>
<td>4.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>1.0</td>
<td>66.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">691</td>
<td>2.0</td>
<td>36.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>4.0</td>
<td>8.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>61.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">730</td>
<td>2.0</td>
<td>36.0</td>
<td>1.0</td>
<td>7.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>6.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>49.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5443</td>
<td>9.0</td>
<td>36.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>6.0</td>
<td>4.0</td>
<td>7.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>54.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1984</td>
<td>3.0</td>
<td>34.0</td>
<td>3.0</td>
<td>7.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>7.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>48.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4296</td>
<td>7.0</td>
<td>36.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>6.0</td>
<td>4.0</td>
<td>8.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>25.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2763</td>
<td>5.0</td>
<td>34.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>6.0</td>
<td>4.0</td>
<td>7.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>34.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3593</td>
<td>6.0</td>
<td>36.0</td>
<td>3.0</td>
<td>7.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>6.0</td>
<td>4.0</td>
<td>8.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>58.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3277</td>
<td>5.0</td>
<td>34.0</td>
<td>1.0</td>
<td>7.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>8.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>5.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>42.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5389</td>
<td>9.0</td>
<td>34.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>8.0</td>
<td>2.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>39.0</td>
</tr>
</tbody>
</table>

<p>4532 rows Ã— 29 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-434307d0-a484-4f52-8811-ab38cf7489bc')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-434307d0-a484-4f52-8811-ab38cf7489bc button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-434307d0-a484-4f52-8811-ab38cf7489bc');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-29a5e30d-36aa-4f64-9a0a-403fff51658b">
  <button class="colab-df-quickchart" onclick="quickchart('df-29a5e30d-36aa-4f64-9a0a-403fff51658b')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-29a5e30d-36aa-4f64-9a0a-403fff51658b button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_766ab62e-48c1-4a5f-93ff-747a6b8411a8">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('X_train_final')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_766ab62e-48c1-4a5f-93ff-747a6b8411a8 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('X_train_final');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div id="cell-13" class="cell" data-outputid="6497c667-2f6a-4ac7-a45a-e4de2243611e">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DMatrix format for XGBoost</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dtrain <span class="op">=</span> xgb.DMatrix(X_train_final, label<span class="op">=</span>y_train)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> xgb.DMatrix(X_test_final, label<span class="op">=</span>y_test)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define XGBoost parameters</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'objective'</span>: <span class="st">'binary:logistic'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'eval_metric'</span>: <span class="st">'logloss'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: <span class="dv">5</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: <span class="fl">0.1</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: <span class="dv">100</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'seed'</span>: <span class="dv">42</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validation</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing cross-validation..."</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>num_round <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> xgb.cv(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    params,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    dtrain,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    num_boost_round<span class="op">=</span>num_round,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    nfold<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">'auc'</span>, <span class="st">'error'</span>],</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    early_stopping_rounds<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    verbose_eval<span class="op">=</span><span class="va">True</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing cross-validation...
[0] train-auc:0.72904+0.00717   train-error:0.13923+0.00246 test-auc:0.63914+0.03029    test-error:0.13923+0.00984
[1] train-auc:0.74121+0.00650   train-error:0.13923+0.00246 test-auc:0.65050+0.03281    test-error:0.13923+0.00984
[2] train-auc:0.74980+0.00536   train-error:0.13923+0.00246 test-auc:0.65789+0.03393    test-error:0.13923+0.00984
[3] train-auc:0.75701+0.00727   train-error:0.13923+0.00246 test-auc:0.65717+0.03223    test-error:0.13923+0.00984
[4] train-auc:0.76338+0.00684   train-error:0.13923+0.00246 test-auc:0.66330+0.03274    test-error:0.13923+0.00984
[5] train-auc:0.76952+0.00707   train-error:0.13923+0.00246 test-auc:0.66412+0.03152    test-error:0.13923+0.00984
[6] train-auc:0.77329+0.00713   train-error:0.13912+0.00241 test-auc:0.66570+0.02975    test-error:0.13923+0.00984
[7] train-auc:0.77670+0.00816   train-error:0.13885+0.00223 test-auc:0.66564+0.02755    test-error:0.13923+0.00984
[8] train-auc:0.78105+0.00848   train-error:0.13857+0.00220 test-auc:0.66675+0.02709    test-error:0.13945+0.00967
[9] train-auc:0.78542+0.00873   train-error:0.13813+0.00239 test-auc:0.66726+0.02838    test-error:0.13945+0.00967</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [04:00:35] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[10]    train-auc:0.79012+0.00617   train-error:0.13758+0.00225 test-auc:0.66581+0.02624    test-error:0.13945+0.00967
[11]    train-auc:0.79638+0.00740   train-error:0.13692+0.00228 test-auc:0.66725+0.02750    test-error:0.13945+0.00967
[12]    train-auc:0.79997+0.00864   train-error:0.13653+0.00261 test-auc:0.66868+0.02840    test-error:0.13967+0.00952
[13]    train-auc:0.80394+0.00838   train-error:0.13609+0.00258 test-auc:0.66558+0.02804    test-error:0.13967+0.00918
[14]    train-auc:0.80669+0.00852   train-error:0.13576+0.00253 test-auc:0.66478+0.02999    test-error:0.13967+0.00918
[15]    train-auc:0.81104+0.00836   train-error:0.13537+0.00250 test-auc:0.66511+0.03062    test-error:0.13945+0.00936
[16]    train-auc:0.81227+0.00863   train-error:0.13482+0.00277 test-auc:0.66637+0.03134    test-error:0.13923+0.00946
[17]    train-auc:0.81605+0.00882   train-error:0.13438+0.00338 test-auc:0.66839+0.03072    test-error:0.13945+0.00931
[18]    train-auc:0.81879+0.00957   train-error:0.13361+0.00334 test-auc:0.66744+0.02975    test-error:0.13967+0.00858
[19]    train-auc:0.82114+0.01037   train-error:0.13305+0.00338 test-auc:0.66828+0.03086    test-error:0.13945+0.00933
[20]    train-auc:0.82445+0.00874   train-error:0.13245+0.00387 test-auc:0.66960+0.02902    test-error:0.13901+0.00908
[21]    train-auc:0.82624+0.00880   train-error:0.13162+0.00414 test-auc:0.66994+0.02746    test-error:0.13879+0.00901
[22]    train-auc:0.82979+0.00980   train-error:0.13112+0.00404 test-auc:0.66941+0.02966    test-error:0.13879+0.00880
[23]    train-auc:0.83073+0.00946   train-error:0.13041+0.00371 test-auc:0.67039+0.02904    test-error:0.13857+0.00841
[24]    train-auc:0.83414+0.01029   train-error:0.12991+0.00358 test-auc:0.66796+0.03002    test-error:0.13857+0.00841
[25]    train-auc:0.83735+0.01163   train-error:0.12925+0.00328 test-auc:0.66852+0.02923    test-error:0.13857+0.00841
[26]    train-auc:0.84148+0.01130   train-error:0.12870+0.00330 test-auc:0.66800+0.03058    test-error:0.13812+0.00874
[27]    train-auc:0.84529+0.01061   train-error:0.12836+0.00327 test-auc:0.66701+0.02953    test-error:0.13790+0.00887
[28]    train-auc:0.84720+0.01062   train-error:0.12770+0.00327 test-auc:0.66731+0.02853    test-error:0.13812+0.00874
[29]    train-auc:0.84962+0.01130   train-error:0.12715+0.00349 test-auc:0.66684+0.02826    test-error:0.13813+0.00861
[30]    train-auc:0.85275+0.01050   train-error:0.12610+0.00355 test-auc:0.66614+0.02878    test-error:0.13813+0.00861
[31]    train-auc:0.85416+0.01075   train-error:0.12572+0.00319 test-auc:0.66590+0.02810    test-error:0.13790+0.00871
[32]    train-auc:0.85600+0.01087   train-error:0.12483+0.00317 test-auc:0.66428+0.02854    test-error:0.13813+0.00861
[33]    train-auc:0.85837+0.01135   train-error:0.12450+0.00339 test-auc:0.66299+0.02943    test-error:0.13790+0.00871
[34]    train-auc:0.86169+0.00901   train-error:0.12401+0.00302 test-auc:0.66171+0.02896    test-error:0.13790+0.00851
[35]    train-auc:0.86323+0.00908   train-error:0.12346+0.00322 test-auc:0.66093+0.02910    test-error:0.13835+0.00821
[36]    train-auc:0.86474+0.00881   train-error:0.12329+0.00319 test-auc:0.66113+0.02873    test-error:0.13857+0.00810
[37]    train-auc:0.86716+0.00913   train-error:0.12257+0.00315 test-auc:0.66113+0.02934    test-error:0.13857+0.00810
[38]    train-auc:0.86932+0.00907   train-error:0.12202+0.00332 test-auc:0.66081+0.02915    test-error:0.13835+0.00824
[39]    train-auc:0.87094+0.00852   train-error:0.12180+0.00307 test-auc:0.66066+0.03035    test-error:0.13835+0.00824
[40]    train-auc:0.87232+0.00831   train-error:0.12119+0.00273 test-auc:0.65967+0.02967    test-error:0.13857+0.00810
[41]    train-auc:0.87502+0.00781   train-error:0.12048+0.00315 test-auc:0.65826+0.02838    test-error:0.13857+0.00810
[42]    train-auc:0.87668+0.00808   train-error:0.11981+0.00271 test-auc:0.65678+0.02758    test-error:0.13879+0.00809
[43]    train-auc:0.87866+0.00812   train-error:0.11970+0.00257 test-auc:0.65662+0.02838    test-error:0.13901+0.00810
[44]    train-auc:0.88010+0.00810   train-error:0.11904+0.00251 test-auc:0.65730+0.02788    test-error:0.13901+0.00810
[45]    train-auc:0.88106+0.00816   train-error:0.11860+0.00274 test-auc:0.65704+0.02792    test-error:0.13923+0.00852
[46]    train-auc:0.88228+0.00824   train-error:0.11766+0.00298 test-auc:0.65611+0.02854    test-error:0.13945+0.00841</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-14" class="cell" data-outputid="652830e7-2e35-4173-93b8-5d5e644d8562">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print CV results</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cross-validation results:"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best AUC: </span><span class="sc">{</span>cv_results[<span class="st">'test-auc-mean'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_results[<span class="st">'test-auc-std'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Error: </span><span class="sc">{</span>cv_results[<span class="st">'test-error-mean'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_results[<span class="st">'test-error-std'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training final model..."</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> xgb.train(params, dtrain, num_round)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(dtest)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>y_pred_binary <span class="op">=</span> (y_pred <span class="op">&gt;</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and print metrics</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Model Performance Metrics:"</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_binary))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Confusion Matrix:"</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test, y_pred_binary)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ROC AUC Score: </span><span class="sc">{</span>roc_auc_score(y_test, y_pred)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance analysis</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> final_model.get_score(importance_type<span class="op">=</span><span class="st">'weight'</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(importance.items()), columns<span class="op">=</span>[<span class="st">'Feature'</span>, <span class="st">'Importance'</span>])</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> importance_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 10 Most Important Features:"</span>)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(importance_df)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot feature importances</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, data<span class="op">=</span>importance_df.head(<span class="dv">10</span>), palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 10 Feature Importances'</span>)</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot confusion matrix</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Label'</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Label'</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-validation results:
Best AUC: 0.6704 (+/- 0.0262)
Best Error: 0.1379 (+/- 0.0084)

Training final model...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [04:07:14] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Performance Metrics:

Classification Report:
              precision    recall  f1-score   support

           0       0.86      0.99      0.92       975
           1       0.31      0.03      0.06       158

    accuracy                           0.86      1133
   macro avg       0.59      0.51      0.49      1133
weighted avg       0.79      0.86      0.80      1133


Confusion Matrix:
[[964  11]
 [153   5]]

ROC AUC Score: 0.6858

Top 10 Most Important Features:
         Feature  Importance
28           AGE       332.0
0          CYCLE       138.0
7       KINDWORK       136.0
20        INCOME       100.0
3          EEDUC        96.0
18      LIVQTRRV        82.0
25      SUPPORT1        77.0
27      SUPPORT3        76.0
24       SOCIAL2        75.0
8      EXPNS_DIF        72.0
5   EGENID_BIRTH        71.0
22   PRICECONCRN        63.0
9     CURFOODSUF        57.0
4             MS        56.0
19        ENERGY        56.0
23       SOCIAL1        55.0
26      SUPPORT2        54.0
10       ANXIOUS        53.0
15        SEEING        50.0
21     PRICECHNG        44.0
1         EST_ST        38.0
14       PUBHLTH        37.0
6     HADCOVIDRV        36.0
13          DOWN        35.0
16   REMEMBERING        33.0
2          RRACE        31.0
17        TENURE        30.0
11         WORRY        29.0
12      INTEREST        17.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x='Importance', y='Feature', data=importance_df.head(10), palette='viridis')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-14-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-14-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div id="cell-15" class="cell" data-outputid="2e435cbb-cad4-4a98-bf91-8ccf842ad9e9">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Fitting Probit model for effect sizes and p-values..."</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant for statsmodels</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>X_train_probit <span class="op">=</span> sm.add_constant(X_train_final)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>probit_model <span class="op">=</span> sm.Probit(y_train, X_train_probit)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>probit_results <span class="op">=</span> probit_model.fit(disp<span class="op">=</span><span class="dv">0</span>)  <span class="co"># disp=0 -&gt; no iteration details</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Probit Model Summary:"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(probit_results.summary())</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># If you want to see marginal effects (average partial effects), uncomment below:</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> probit_results.get_margeff()</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Marginal Effects:"</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(me.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fitting Probit model for effect sizes and p-values...

Probit Model Summary:
                          Probit Regression Results                           
==============================================================================
Dep. Variable:            TWDAYS_RESP   No. Observations:                 4532
Model:                         Probit   Df Residuals:                     4502
Method:                           MLE   Df Model:                           29
Date:                Fri, 31 Jan 2025   Pseudo R-squ.:                 0.05405
Time:                        04:00:44   Log-Likelihood:                -1730.1
converged:                       True   LL-Null:                       -1829.0
Covariance Type:            nonrobust   LLR p-value:                 4.968e-27
================================================================================
                   coef    std err          z      P&gt;|z|      [0.025      0.975]
--------------------------------------------------------------------------------
const           -1.6437      1.003     -1.639      0.101      -3.609       0.322
CYCLE           -0.0102      0.010     -1.053      0.293      -0.029       0.009
EST_ST           0.0590      0.026      2.302      0.021       0.009       0.109
RRACE           -0.0138      0.029     -0.475      0.635      -0.071       0.043
EEDUC           -0.1432      0.023     -6.185      0.000      -0.189      -0.098
MS              -0.0579      0.017     -3.412      0.001      -0.091      -0.025
EGENID_BIRTH     0.0153      0.050      0.307      0.759      -0.082       0.113
HADCOVIDRV      -0.0206      0.057     -0.362      0.717      -0.132       0.091
KINDWORK        -0.0680      0.029     -2.381      0.017      -0.124      -0.012
EXPNS_DIF        0.0525      0.037      1.434      0.152      -0.019       0.124
CURFOODSUF       0.0481      0.060      0.799      0.425      -0.070       0.166
ANXIOUS         -0.1246      0.050     -2.516      0.012      -0.222      -0.028
WORRY            0.0650      0.053      1.220      0.222      -0.039       0.169
INTEREST        -0.0053      0.055     -0.097      0.923      -0.114       0.103
DOWN             0.1047      0.059      1.767      0.077      -0.011       0.221
PUBHLTH         -0.0555      0.053     -1.043      0.297      -0.160       0.049
SEEING           0.0497      0.055      0.901      0.368      -0.058       0.158
REMEMBERING     -0.0178      0.058     -0.307      0.759      -0.131       0.096
TENURE           0.0076      0.046      0.165      0.869      -0.083       0.098
LIVQTRRV        -0.0896      0.018     -4.977      0.000      -0.125      -0.054
ENERGY           0.0316      0.039      0.808      0.419      -0.045       0.108
INCOME          -0.0499      0.018     -2.846      0.004      -0.084      -0.016
PRICECHNG       -0.0007      0.031     -0.021      0.983      -0.062       0.061
PRICECONCRN      0.0165      0.030      0.553      0.580      -0.042       0.075
SOCIAL1         -0.0213      0.027     -0.775      0.438      -0.075       0.032
SOCIAL2          0.1105      0.033      3.343      0.001       0.046       0.175
SUPPORT1        -0.0149      0.024     -0.616      0.538      -0.062       0.032
SUPPORT2        -0.0592      0.032     -1.824      0.068      -0.123       0.004
SUPPORT3         0.0615      0.022      2.771      0.006       0.018       0.105
AGE             -0.0058      0.002     -2.494      0.013      -0.010      -0.001
================================================================================

Marginal Effects:
       Probit Marginal Effects       
=====================================
Dep. Variable:            TWDAYS_RESP
Method:                          dydx
At:                           overall
================================================================================
                  dy/dx    std err          z      P&gt;|z|      [0.025      0.975]
--------------------------------------------------------------------------------
CYCLE           -0.0021      0.002     -1.053      0.292      -0.006       0.002
EST_ST           0.0124      0.005      2.303      0.021       0.002       0.023
RRACE           -0.0029      0.006     -0.475      0.635      -0.015       0.009
EEDUC           -0.0301      0.005     -6.217      0.000      -0.040      -0.021
MS              -0.0122      0.004     -3.416      0.001      -0.019      -0.005
EGENID_BIRTH     0.0032      0.010      0.307      0.759      -0.017       0.024
HADCOVIDRV      -0.0043      0.012     -0.362      0.717      -0.028       0.019
KINDWORK        -0.0143      0.006     -2.383      0.017      -0.026      -0.003
EXPNS_DIF        0.0110      0.008      1.434      0.151      -0.004       0.026
CURFOODSUF       0.0101      0.013      0.799      0.425      -0.015       0.035
ANXIOUS         -0.0262      0.010     -2.518      0.012      -0.047      -0.006
WORRY            0.0136      0.011      1.221      0.222      -0.008       0.036
INTEREST        -0.0011      0.012     -0.097      0.923      -0.024       0.022
DOWN             0.0220      0.012      1.767      0.077      -0.002       0.046
PUBHLTH         -0.0117      0.011     -1.043      0.297      -0.034       0.010
SEEING           0.0104      0.012      0.901      0.368      -0.012       0.033
REMEMBERING     -0.0037      0.012     -0.307      0.759      -0.028       0.020
TENURE           0.0016      0.010      0.165      0.869      -0.017       0.021
LIVQTRRV        -0.0188      0.004     -4.987      0.000      -0.026      -0.011
ENERGY           0.0066      0.008      0.808      0.419      -0.009       0.023
INCOME          -0.0105      0.004     -2.847      0.004      -0.018      -0.003
PRICECHNG       -0.0001      0.007     -0.021      0.983      -0.013       0.013
PRICECONCRN      0.0035      0.006      0.553      0.580      -0.009       0.016
SOCIAL1         -0.0045      0.006     -0.775      0.438      -0.016       0.007
SOCIAL2          0.0232      0.007      3.348      0.001       0.010       0.037
SUPPORT1        -0.0031      0.005     -0.616      0.538      -0.013       0.007
SUPPORT2        -0.0124      0.007     -1.825      0.068      -0.026       0.001
SUPPORT3         0.0129      0.005      2.773      0.006       0.004       0.022
AGE             -0.0012      0.000     -2.495      0.013      -0.002      -0.000
================================================================================</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div id="cell-16" class="cell" data-outputid="64584cac-0e9f-4710-84e3-3aa57ab9827f">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Calculating and plotting SHAP values for XGBoost model..."</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(final_model)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_test_final)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SHAP Beeswarm (summary) Plot ---</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating SHAP Beeswarm plot..."</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_test_final)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SHAP Bar Plot of Mean Absolute SHAP Values ---</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating SHAP Bar plot..."</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_test_final, plot_type<span class="op">=</span><span class="st">"bar"</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) If you want to examine a single observation or more advanced plots:</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># idx_to_explain = 0  # index in X_test_final</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># shap.force_plot(</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     explainer.expected_value,</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     shap_values[idx_to_explain,:],</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     X_test_final.iloc[idx_to_explain,:],</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     matplotlib=True</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Calculating and plotting SHAP values for XGBoost model...
Generating SHAP Beeswarm plot...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating SHAP Bar plot...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-16-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div id="cell-17" class="cell markdown">
<section id="cps-binary-classification-model" class="level1">
<h1>CPS Binary Classification Model</h1>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div id="cell-18" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score, confusion_matrix, roc_auc_score</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> RFECV, SelectKBest, mutual_info_classif</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> parallel_backend</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div id="cell-19" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare data</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> pd.read_csv(<span class="st">"filtered_df.csv"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> filtered_df[(filtered_df[<span class="st">'gestfips'</span>]<span class="op">==</span><span class="dv">34</span>) <span class="op">|</span> (filtered_df[<span class="st">'gestfips'</span>]<span class="op">==</span><span class="dv">36</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div id="cell-20" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> filtered_df[[<span class="st">'hehousut'</span>,<span class="st">'hetelhhd'</span>,<span class="st">'hetelavl'</span>,<span class="st">'hefaminc'</span>,<span class="st">'hrnumhou'</span>,<span class="st">'hrhtype'</span>,<span class="st">'HUBUS'</span>,<span class="st">'gereg'</span>,<span class="st">'gediv'</span>,<span class="st">'gestfips'</span>,<span class="st">'gtcbsa'</span>,<span class="st">'gtco'</span>,<span class="st">'gtcbsast'</span>,<span class="st">'gtmetsta'</span>,<span class="st">'gtindvpc'</span>,<span class="st">'gtcbsasz'</span>,<span class="st">'gtcsa'</span>,<span class="st">'perrp'</span>,<span class="st">'prtage'</span>,<span class="st">'pemaritl'</span>,<span class="st">'pesex'</span>,<span class="st">'peeduca'</span>,<span class="st">'ptdtrace'</span>,<span class="st">'prdthsp'</span>,<span class="st">'PUCHINHH'</span>,<span class="st">'prfamrel'</span>,<span class="st">'prfamtyp'</span>,<span class="st">'pehspnon'</span>,<span class="st">'penatvty'</span>,<span class="st">'pemntvty'</span>,<span class="st">'pefntvty'</span>,<span class="st">'prcitshp'</span>,<span class="st">'prinuyer'</span>,<span class="st">'PUWK'</span>,<span class="st">'pemjot'</span>,<span class="st">'pemjnum'</span>,<span class="st">'pehruslt'</span>,<span class="st">'pehractt'</span>,<span class="st">'peio1cow'</span>,<span class="st">'prdtind1'</span>,<span class="st">'prdtocc1'</span>,<span class="st">'pternwa'</span>,<span class="st">'ptwk'</span>,<span class="st">'prchld'</span>,<span class="st">'prnmchld'</span>]]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> filtered_df[<span class="st">'pttlwk'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div id="cell-21" class="cell" data-outputid="6c6152fe-c5ed-4085-a92a-5246049b34a0" data-execution_count="4">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

  <div id="df-c4cc3bcb-c274-46e4-b3a6-3da297519001" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hehousut</th>
<th data-quarto-table-cell-role="th">hetelhhd</th>
<th data-quarto-table-cell-role="th">hetelavl</th>
<th data-quarto-table-cell-role="th">hefaminc</th>
<th data-quarto-table-cell-role="th">hrnumhou</th>
<th data-quarto-table-cell-role="th">hrhtype</th>
<th data-quarto-table-cell-role="th">HUBUS</th>
<th data-quarto-table-cell-role="th">gereg</th>
<th data-quarto-table-cell-role="th">gediv</th>
<th data-quarto-table-cell-role="th">gestfips</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">pemjnum</th>
<th data-quarto-table-cell-role="th">pehruslt</th>
<th data-quarto-table-cell-role="th">pehractt</th>
<th data-quarto-table-cell-role="th">peio1cow</th>
<th data-quarto-table-cell-role="th">prdtind1</th>
<th data-quarto-table-cell-role="th">prdtocc1</th>
<th data-quarto-table-cell-role="th">pternwa</th>
<th data-quarto-table-cell-role="th">ptwk</th>
<th data-quarto-table-cell-role="th">prchld</th>
<th data-quarto-table-cell-role="th">prnmchld</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">651</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>14</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>48.0</td>
<td>4.0</td>
<td>25.0</td>
<td>21.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">652</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>14</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>40.0</td>
<td>2.0</td>
<td>51.0</td>
<td>14.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">653</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>11</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>40.0</td>
<td>4.0</td>
<td>14.0</td>
<td>22.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">654</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>11</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>40.0</td>
<td>4.0</td>
<td>22.0</td>
<td>17.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">655</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>12</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>20.0</td>
<td>20.0</td>
<td>7.0</td>
<td>36.0</td>
<td>7.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">318282</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>10</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>36</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>40.0</td>
<td>4.0</td>
<td>42.0</td>
<td>11.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">318283</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>15</td>
<td>1</td>
<td>6</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>36</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>40.0</td>
<td>1.0</td>
<td>51.0</td>
<td>20.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">318284</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>14</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>36</td>
<td>...</td>
<td>-1.0</td>
<td>50.0</td>
<td>50.0</td>
<td>4.0</td>
<td>40.0</td>
<td>13.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">318399</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>16</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>20.0</td>
<td>20.0</td>
<td>4.0</td>
<td>22.0</td>
<td>16.0</td>
<td>-1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">318400</td>
<td>1</td>
<td>1</td>
<td>-1</td>
<td>16</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>...</td>
<td>-1.0</td>
<td>40.0</td>
<td>40.0</td>
<td>4.0</td>
<td>38.0</td>
<td>22.0</td>
<td>-1.0</td>
<td>0</td>
<td>4.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

<p>17819 rows Ã— 45 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-c4cc3bcb-c274-46e4-b3a6-3da297519001')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-c4cc3bcb-c274-46e4-b3a6-3da297519001 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-c4cc3bcb-c274-46e4-b3a6-3da297519001');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-e7b5a8f5-7541-49da-9d34-3db79ecd3e1c">
  <button class="colab-df-quickchart" onclick="quickchart('df-e7b5a8f5-7541-49da-9d34-3db79ecd3e1c')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-e7b5a8f5-7541-49da-9d34-3db79ecd3e1c button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_22293359-c72c-4224-8eb3-2c83430b5639">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('X')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_22293359-c72c-4224-8eb3-2c83430b5639 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('X');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div id="cell-22" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert labels from 1.0/2.0 to 0/1</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> (y <span class="op">==</span> <span class="fl">2.0</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div id="cell-23" class="cell" data-outputid="8e2d5157-0082-44f5-cdf2-71725598d9b6" data-execution_count="6">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>y.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">pttlwk</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>13529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>4290</td>
</tr>
</tbody>
</table>

</div><br><label><b>dtype:</b> int64</label>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-24" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Initialize label encoders dictionary</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># encoders = {}</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Label encode all feature columns</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for column in X.columns:</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     encoders[column] = LabelEncoder()</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     X[column] = encoders[column].fit_transform(X[column])</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Label encode target variable</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># target_encoder = LabelEncoder()</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># y = target_encoder.fit_transform(y)</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Shape of X after encoding:", X.shape)</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Shape of y after encoding:", y.shape)</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nUnique values in target variable:", np.unique(y))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-25" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Performing initial feature selection...")</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># selector = SelectKBest(mutual_info_classif, k=100)  # Keep top 50 features</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># X_reduced = selector.fit_transform(X, y)</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># selected_features = X.columns[selector.get_support(indices=True)]</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Top 50 features selected.")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="vif" class="cell" data-outputid="18310b87-0b69-472e-ed3b-e60379dd9057" data-execution_count="9">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with reduced features for VIF and further steps</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># X = pd.DataFrame(X_reduced, columns=selected_features)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_vif(df):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    vif_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    vif_data[<span class="st">"Feature"</span>] <span class="op">=</span> df.columns</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    vif_data[<span class="st">"VIF"</span>] <span class="op">=</span> [variance_inflation_factor(df.values, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df.shape[<span class="dv">1</span>])]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vif_data</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIF for all features</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing multicollinearity analysis..."</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>vif_data <span class="op">=</span> calculate_vif(X)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VIF Results:"</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vif_data)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop features with high VIF (&gt;10)</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>high_vif_features <span class="op">=</span> vif_data[vif_data[<span class="st">"VIF"</span>] <span class="op">&gt;</span> <span class="dv">10</span>][<span class="st">"Feature"</span>].tolist()</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dropping features with high VIF: </span><span class="sc">{</span>high_vif_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop(columns<span class="op">=</span>high_vif_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing multicollinearity analysis...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/statsmodels/regression/linear_model.py:1782: RuntimeWarning: divide by zero encountered in scalar divide
  return 1 - self.ssr/self.centered_tss</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VIF Results:
     Feature        VIF
0   hehousut   1.046027
1   hetelhhd   2.254292
2   hetelavl   2.282600
3   hefaminc   1.434420
4   hrnumhou   2.452866
5    hrhtype   4.732866
6      HUBUS   1.156651
7      gereg   0.000000
8      gediv   0.000000
9   gestfips   2.652757
10    gtcbsa   2.183617
11      gtco   2.202980
12  gtcbsast   4.391335
13  gtmetsta   2.231556
14  gtindvpc   2.651372
15  gtcbsasz   9.794757
16     gtcsa   5.458005
17     perrp   5.387685
18    prtage   1.678536
19  pemaritl   3.464919
20     pesex   1.148676
21   peeduca   1.524835
22  ptdtrace   1.271114
23   prdthsp   5.773714
24  PUCHINHH   1.015834
25  prfamrel   6.719113
26  prfamtyp   4.662360
27  pehspnon   5.659180
28  penatvty   7.903467
29  pemntvty   8.318010
30  pefntvty   7.946751
31  prcitshp  12.204819
32  prinuyer   8.446316
33      PUWK   1.015886
34    pemjot  83.410023
35   pemjnum  83.510317
36  pehruslt   2.022003
37  pehractt   2.050188
38  peio1cow   1.171097
39  prdtind1   1.193875
40  prdtocc1   1.359964
41   pternwa   3.260463
42      ptwk   3.171225
43    prchld   4.825561
44  prnmchld   5.667953
Dropping features with high VIF: ['prcitshp', 'pemjot', 'pemjnum']</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div id="cell-27" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div id="cell-28" class="cell" data-outputid="c892fe23-e3fc-49c4-fe9b-bc2a902cc40f" data-execution_count="11">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive Feature Elimination</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing Recursive Feature Elimination..."</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> parallel_backend(<span class="st">'threading'</span>):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    rf_model <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    rfecv <span class="op">=</span> RFECV(estimator<span class="op">=</span>rf_model, step<span class="op">=</span><span class="dv">1</span>, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    rfecv.fit(X_train, y_train)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get selected features from RFE</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>rfe_selected_features <span class="op">=</span> rfecv.support_</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>X_train_final <span class="op">=</span> X_train.iloc[:, rfe_selected_features]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>X_test_final <span class="op">=</span> X_test.iloc[:, rfe_selected_features]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing Recursive Feature Elimination...</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-29" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Outlier Analysis</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Performing outlier analysis...")</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z_scores = np.abs((X_train_final - np.mean(X_train_final, axis=0)) / np.std(X_train_final, axis=0))</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = 3</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># non_outliers = (z_scores &lt; threshold).all(axis=1)</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># outlier_percentage = 100 * (1 - np.sum(non_outliers) / len(non_outliers))</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Percentage of outliers removed: {outlier_percentage:.2f}%")</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Align indices before filtering</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_final = X_train_final[non_outliers].reset_index(drop=True)</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Use the index from X_train_final before reset to filter y_train</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train = y_train[X_train_final.index[non_outliers]].reset_index(drop=True)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div id="cell-30" class="cell" data-outputid="a9ef0925-2754-423c-b587-a83c01989c99" data-execution_count="13">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>X_train_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

  <div id="df-d96efa5a-f61c-4769-898f-b16887472d43" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hefaminc</th>
<th data-quarto-table-cell-role="th">hrnumhou</th>
<th data-quarto-table-cell-role="th">hrhtype</th>
<th data-quarto-table-cell-role="th">HUBUS</th>
<th data-quarto-table-cell-role="th">gestfips</th>
<th data-quarto-table-cell-role="th">gtcbsa</th>
<th data-quarto-table-cell-role="th">gtco</th>
<th data-quarto-table-cell-role="th">gtcbsast</th>
<th data-quarto-table-cell-role="th">gtindvpc</th>
<th data-quarto-table-cell-role="th">gtcbsasz</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">pefntvty</th>
<th data-quarto-table-cell-role="th">prinuyer</th>
<th data-quarto-table-cell-role="th">pehruslt</th>
<th data-quarto-table-cell-role="th">pehractt</th>
<th data-quarto-table-cell-role="th">peio1cow</th>
<th data-quarto-table-cell-role="th">prdtind1</th>
<th data-quarto-table-cell-role="th">prdtocc1</th>
<th data-quarto-table-cell-role="th">pternwa</th>
<th data-quarto-table-cell-role="th">prchld</th>
<th data-quarto-table-cell-role="th">prnmchld</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">143322</td>
<td>9</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>36</td>
<td>15380</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>...</td>
<td>57.0</td>
<td>0.0</td>
<td>30.0</td>
<td>30.0</td>
<td>4.0</td>
<td>46.0</td>
<td>13.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">318280</td>
<td>15</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>36</td>
<td>10580</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>4</td>
<td>...</td>
<td>117.0</td>
<td>0.0</td>
<td>40.0</td>
<td>40.0</td>
<td>4.0</td>
<td>19.0</td>
<td>22.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316593</td>
<td>16</td>
<td>9</td>
<td>1</td>
<td>2</td>
<td>36</td>
<td>35620</td>
<td>81</td>
<td>1</td>
<td>1</td>
<td>7</td>
<td>...</td>
<td>333.0</td>
<td>0.0</td>
<td>25.0</td>
<td>25.0</td>
<td>1.0</td>
<td>51.0</td>
<td>12.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78397</td>
<td>11</td>
<td>4</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>57.0</td>
<td>0.0</td>
<td>40.0</td>
<td>40.0</td>
<td>3.0</td>
<td>40.0</td>
<td>22.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">92298</td>
<td>15</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>45940</td>
<td>21</td>
<td>4</td>
<td>0</td>
<td>3</td>
<td>...</td>
<td>57.0</td>
<td>0.0</td>
<td>40.0</td>
<td>1.0</td>
<td>4.0</td>
<td>19.0</td>
<td>17.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">143188</td>
<td>16</td>
<td>4</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>35620</td>
<td>13</td>
<td>2</td>
<td>0</td>
<td>7</td>
<td>...</td>
<td>57.0</td>
<td>0.0</td>
<td>40.0</td>
<td>40.0</td>
<td>1.0</td>
<td>51.0</td>
<td>7.0</td>
<td>-1.0</td>
<td>5.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">164531</td>
<td>11</td>
<td>5</td>
<td>3</td>
<td>2</td>
<td>36</td>
<td>35620</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>7</td>
<td>...</td>
<td>328.0</td>
<td>24.0</td>
<td>25.0</td>
<td>25.0</td>
<td>3.0</td>
<td>51.0</td>
<td>12.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44316</td>
<td>13</td>
<td>1</td>
<td>6</td>
<td>2</td>
<td>36</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>57.0</td>
<td>0.0</td>
<td>40.0</td>
<td>40.0</td>
<td>4.0</td>
<td>42.0</td>
<td>21.0</td>
<td>72000.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">297427</td>
<td>12</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>34</td>
<td>35620</td>
<td>13</td>
<td>2</td>
<td>0</td>
<td>7</td>
<td>...</td>
<td>370.0</td>
<td>28.0</td>
<td>60.0</td>
<td>60.0</td>
<td>7.0</td>
<td>36.0</td>
<td>9.0</td>
<td>-1.0</td>
<td>3.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36780</td>
<td>16</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>36</td>
<td>15380</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>5</td>
<td>...</td>
<td>57.0</td>
<td>0.0</td>
<td>20.0</td>
<td>20.0</td>
<td>4.0</td>
<td>29.0</td>
<td>20.0</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>14255 rows Ã— 30 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-d96efa5a-f61c-4769-898f-b16887472d43')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-d96efa5a-f61c-4769-898f-b16887472d43 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-d96efa5a-f61c-4769-898f-b16887472d43');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-b115a9b2-c702-4d59-9a56-326ee544bef3">
  <button class="colab-df-quickchart" onclick="quickchart('df-b115a9b2-c702-4d59-9a56-326ee544bef3')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-b115a9b2-c702-4d59-9a56-326ee544bef3 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_22e9f9c1-d540-4507-b21f-9248e10dc819">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('X_train_final')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_22e9f9c1-d540-4507-b21f-9248e10dc819 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('X_train_final');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-31" class="cell" data-outputid="e973ae61-819d-4734-a994-a74a2a5f7193" data-execution_count="14">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DMatrix format for XGBoost</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>dtrain <span class="op">=</span> xgb.DMatrix(X_train_final, label<span class="op">=</span>y_train)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> xgb.DMatrix(X_test_final, label<span class="op">=</span>y_test)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define XGBoost parameters</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'objective'</span>: <span class="st">'binary:logistic'</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'eval_metric'</span>: <span class="st">'logloss'</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: <span class="dv">5</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: <span class="fl">0.1</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: <span class="dv">100</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'seed'</span>: <span class="dv">42</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validation</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing cross-validation..."</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>num_round <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> xgb.cv(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    params,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    dtrain,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    num_boost_round<span class="op">=</span>num_round,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    nfold<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">'auc'</span>, <span class="st">'error'</span>],</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    early_stopping_rounds<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    verbose_eval<span class="op">=</span><span class="va">True</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing cross-validation...
[0] train-auc:0.84550+0.00162   train-error:0.24076+0.00117 test-auc:0.83084+0.00405    test-error:0.24076+0.00468
[1] train-auc:0.85108+0.00091   train-error:0.24076+0.00117 test-auc:0.83766+0.00555    test-error:0.24076+0.00468
[2] train-auc:0.85450+0.00175   train-error:0.24076+0.00117 test-auc:0.84107+0.00493    test-error:0.24076+0.00468
[3] train-auc:0.85600+0.00190   train-error:0.24076+0.00117 test-auc:0.84246+0.00456    test-error:0.24076+0.00468
[4] train-auc:0.85822+0.00136   train-error:0.24076+0.00117 test-auc:0.84453+0.00454    test-error:0.24076+0.00468</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [05:33:21] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[5] train-auc:0.86179+0.00331   train-error:0.24046+0.00104 test-auc:0.84622+0.00409    test-error:0.24062+0.00477
[6] train-auc:0.86704+0.00245   train-error:0.22038+0.01036 test-auc:0.85064+0.00415    test-error:0.22448+0.00933
[7] train-auc:0.86990+0.00301   train-error:0.20051+0.00366 test-auc:0.85308+0.00421    test-error:0.20744+0.00496
[8] train-auc:0.87272+0.00163   train-error:0.18886+0.00164 test-auc:0.85495+0.00438    test-error:0.19551+0.00420
[9] train-auc:0.87495+0.00115   train-error:0.18346+0.00179 test-auc:0.85689+0.00411    test-error:0.19074+0.00270
[10]    train-auc:0.87717+0.00113   train-error:0.18143+0.00199 test-auc:0.85855+0.00410    test-error:0.18871+0.00339
[11]    train-auc:0.87898+0.00138   train-error:0.17866+0.00137 test-auc:0.86038+0.00398    test-error:0.18702+0.00132
[12]    train-auc:0.88076+0.00112   train-error:0.17608+0.00184 test-auc:0.86169+0.00396    test-error:0.18471+0.00357
[13]    train-auc:0.88210+0.00097   train-error:0.17420+0.00198 test-auc:0.86243+0.00393    test-error:0.18302+0.00244
[14]    train-auc:0.88343+0.00097   train-error:0.17220+0.00197 test-auc:0.86327+0.00391    test-error:0.18281+0.00254
[15]    train-auc:0.88504+0.00105   train-error:0.17092+0.00188 test-auc:0.86466+0.00360    test-error:0.18141+0.00310
[16]    train-auc:0.88660+0.00101   train-error:0.16984+0.00225 test-auc:0.86528+0.00350    test-error:0.18064+0.00284
[17]    train-auc:0.88781+0.00117   train-error:0.16819+0.00211 test-auc:0.86620+0.00336    test-error:0.18085+0.00317
[18]    train-auc:0.88933+0.00129   train-error:0.16654+0.00178 test-auc:0.86720+0.00352    test-error:0.17994+0.00236
[19]    train-auc:0.89063+0.00128   train-error:0.16519+0.00214 test-auc:0.86812+0.00367    test-error:0.17952+0.00156
[20]    train-auc:0.89191+0.00111   train-error:0.16373+0.00224 test-auc:0.86901+0.00388    test-error:0.17790+0.00179
[21]    train-auc:0.89321+0.00127   train-error:0.16242+0.00249 test-auc:0.86994+0.00382    test-error:0.17608+0.00234
[22]    train-auc:0.89441+0.00090   train-error:0.16122+0.00216 test-auc:0.87096+0.00396    test-error:0.17454+0.00127
[23]    train-auc:0.89540+0.00084   train-error:0.15982+0.00222 test-auc:0.87171+0.00389    test-error:0.17355+0.00153
[24]    train-auc:0.89649+0.00108   train-error:0.15805+0.00215 test-auc:0.87229+0.00390    test-error:0.17257+0.00222
[25]    train-auc:0.89755+0.00107   train-error:0.15724+0.00207 test-auc:0.87280+0.00417    test-error:0.17264+0.00185
[26]    train-auc:0.89841+0.00106   train-error:0.15617+0.00233 test-auc:0.87343+0.00418    test-error:0.17166+0.00228
[27]    train-auc:0.89925+0.00103   train-error:0.15582+0.00247 test-auc:0.87383+0.00411    test-error:0.17089+0.00294
[28]    train-auc:0.89986+0.00095   train-error:0.15498+0.00219 test-auc:0.87411+0.00405    test-error:0.17096+0.00324
[29]    train-auc:0.90054+0.00077   train-error:0.15479+0.00231 test-auc:0.87449+0.00400    test-error:0.17054+0.00290
[30]    train-auc:0.90109+0.00080   train-error:0.15423+0.00193 test-auc:0.87485+0.00391    test-error:0.16976+0.00328
[31]    train-auc:0.90180+0.00098   train-error:0.15370+0.00153 test-auc:0.87537+0.00397    test-error:0.17005+0.00264
[32]    train-auc:0.90244+0.00104   train-error:0.15303+0.00169 test-auc:0.87572+0.00379    test-error:0.17026+0.00178
[33]    train-auc:0.90308+0.00094   train-error:0.15209+0.00183 test-auc:0.87614+0.00382    test-error:0.16955+0.00313
[34]    train-auc:0.90397+0.00126   train-error:0.15137+0.00201 test-auc:0.87652+0.00370    test-error:0.16906+0.00203
[35]    train-auc:0.90459+0.00148   train-error:0.15021+0.00207 test-auc:0.87698+0.00376    test-error:0.16794+0.00238
[36]    train-auc:0.90521+0.00113   train-error:0.14951+0.00167 test-auc:0.87729+0.00403    test-error:0.16836+0.00251
[37]    train-auc:0.90611+0.00129   train-error:0.14865+0.00175 test-auc:0.87794+0.00388    test-error:0.16829+0.00231
[38]    train-auc:0.90679+0.00124   train-error:0.14793+0.00162 test-auc:0.87813+0.00384    test-error:0.16773+0.00213
[39]    train-auc:0.90777+0.00116   train-error:0.14681+0.00206 test-auc:0.87855+0.00389    test-error:0.16689+0.00238
[40]    train-auc:0.90814+0.00126   train-error:0.14646+0.00206 test-auc:0.87881+0.00389    test-error:0.16626+0.00218
[41]    train-auc:0.90889+0.00155   train-error:0.14590+0.00229 test-auc:0.87915+0.00367    test-error:0.16619+0.00193
[42]    train-auc:0.90923+0.00147   train-error:0.14581+0.00214 test-auc:0.87937+0.00376    test-error:0.16626+0.00290
[43]    train-auc:0.91005+0.00140   train-error:0.14562+0.00221 test-auc:0.87985+0.00373    test-error:0.16535+0.00228
[44]    train-auc:0.91060+0.00165   train-error:0.14507+0.00241 test-auc:0.88012+0.00353    test-error:0.16499+0.00316
[45]    train-auc:0.91126+0.00124   train-error:0.14411+0.00181 test-auc:0.88032+0.00366    test-error:0.16478+0.00338
[46]    train-auc:0.91179+0.00127   train-error:0.14318+0.00208 test-auc:0.88063+0.00373    test-error:0.16436+0.00293
[47]    train-auc:0.91219+0.00126   train-error:0.14297+0.00178 test-auc:0.88077+0.00366    test-error:0.16415+0.00310
[48]    train-auc:0.91255+0.00120   train-error:0.14274+0.00142 test-auc:0.88100+0.00367    test-error:0.16373+0.00295
[49]    train-auc:0.91312+0.00143   train-error:0.14228+0.00146 test-auc:0.88124+0.00372    test-error:0.16352+0.00332
[50]    train-auc:0.91370+0.00138   train-error:0.14179+0.00166 test-auc:0.88155+0.00392    test-error:0.16401+0.00376
[51]    train-auc:0.91428+0.00138   train-error:0.14106+0.00132 test-auc:0.88190+0.00387    test-error:0.16345+0.00382
[52]    train-auc:0.91454+0.00131   train-error:0.14081+0.00148 test-auc:0.88203+0.00388    test-error:0.16303+0.00330
[53]    train-auc:0.91490+0.00138   train-error:0.14093+0.00146 test-auc:0.88219+0.00393    test-error:0.16310+0.00358
[54]    train-auc:0.91560+0.00137   train-error:0.14025+0.00157 test-auc:0.88252+0.00398    test-error:0.16233+0.00383
[55]    train-auc:0.91624+0.00121   train-error:0.13964+0.00160 test-auc:0.88279+0.00404    test-error:0.16247+0.00426
[56]    train-auc:0.91667+0.00102   train-error:0.13934+0.00142 test-auc:0.88295+0.00409    test-error:0.16226+0.00444
[57]    train-auc:0.91727+0.00089   train-error:0.13885+0.00166 test-auc:0.88305+0.00415    test-error:0.16212+0.00437
[58]    train-auc:0.91782+0.00097   train-error:0.13837+0.00158 test-auc:0.88327+0.00409    test-error:0.16191+0.00414
[59]    train-auc:0.91839+0.00102   train-error:0.13820+0.00180 test-auc:0.88357+0.00392    test-error:0.16135+0.00434
[60]    train-auc:0.91892+0.00119   train-error:0.13799+0.00179 test-auc:0.88376+0.00386    test-error:0.16135+0.00373
[61]    train-auc:0.91948+0.00100   train-error:0.13707+0.00138 test-auc:0.88398+0.00393    test-error:0.16170+0.00351
[62]    train-auc:0.91976+0.00105   train-error:0.13686+0.00150 test-auc:0.88413+0.00391    test-error:0.16135+0.00371
[63]    train-auc:0.92011+0.00101   train-error:0.13688+0.00147 test-auc:0.88425+0.00384    test-error:0.16107+0.00405
[64]    train-auc:0.92049+0.00096   train-error:0.13625+0.00195 test-auc:0.88441+0.00384    test-error:0.16093+0.00393
[65]    train-auc:0.92116+0.00111   train-error:0.13515+0.00195 test-auc:0.88482+0.00391    test-error:0.16043+0.00405
[66]    train-auc:0.92142+0.00109   train-error:0.13515+0.00200 test-auc:0.88494+0.00388    test-error:0.16036+0.00346
[67]    train-auc:0.92189+0.00098   train-error:0.13462+0.00145 test-auc:0.88500+0.00398    test-error:0.16058+0.00312
[68]    train-auc:0.92222+0.00093   train-error:0.13441+0.00159 test-auc:0.88515+0.00404    test-error:0.15994+0.00343
[69]    train-auc:0.92261+0.00099   train-error:0.13427+0.00156 test-auc:0.88534+0.00390    test-error:0.15952+0.00294
[70]    train-auc:0.92307+0.00098   train-error:0.13369+0.00142 test-auc:0.88556+0.00374    test-error:0.15938+0.00370
[71]    train-auc:0.92326+0.00094   train-error:0.13350+0.00150 test-auc:0.88563+0.00379    test-error:0.15910+0.00379
[72]    train-auc:0.92360+0.00107   train-error:0.13336+0.00175 test-auc:0.88580+0.00368    test-error:0.15896+0.00353
[73]    train-auc:0.92397+0.00106   train-error:0.13302+0.00189 test-auc:0.88590+0.00364    test-error:0.15875+0.00353
[74]    train-auc:0.92440+0.00094   train-error:0.13269+0.00158 test-auc:0.88608+0.00381    test-error:0.15875+0.00372
[75]    train-auc:0.92480+0.00085   train-error:0.13260+0.00128 test-auc:0.88610+0.00374    test-error:0.15854+0.00379
[76]    train-auc:0.92521+0.00081   train-error:0.13178+0.00091 test-auc:0.88624+0.00354    test-error:0.15826+0.00320
[77]    train-auc:0.92546+0.00085   train-error:0.13166+0.00107 test-auc:0.88640+0.00357    test-error:0.15854+0.00322
[78]    train-auc:0.92572+0.00086   train-error:0.13153+0.00111 test-auc:0.88647+0.00350    test-error:0.15861+0.00319
[79]    train-auc:0.92608+0.00096   train-error:0.13127+0.00140 test-auc:0.88659+0.00346    test-error:0.15861+0.00337
[80]    train-auc:0.92632+0.00089   train-error:0.13129+0.00167 test-auc:0.88657+0.00355    test-error:0.15805+0.00395
[81]    train-auc:0.92655+0.00102   train-error:0.13113+0.00173 test-auc:0.88667+0.00344    test-error:0.15812+0.00375
[82]    train-auc:0.92680+0.00105   train-error:0.13064+0.00193 test-auc:0.88679+0.00341    test-error:0.15854+0.00440
[83]    train-auc:0.92715+0.00113   train-error:0.13041+0.00216 test-auc:0.88689+0.00344    test-error:0.15833+0.00357
[84]    train-auc:0.92752+0.00122   train-error:0.12966+0.00201 test-auc:0.88708+0.00349    test-error:0.15791+0.00325
[85]    train-auc:0.92778+0.00119   train-error:0.12952+0.00188 test-auc:0.88720+0.00356    test-error:0.15833+0.00332
[86]    train-auc:0.92810+0.00139   train-error:0.12918+0.00232 test-auc:0.88729+0.00366    test-error:0.15805+0.00358
[87]    train-auc:0.92849+0.00158   train-error:0.12857+0.00272 test-auc:0.88746+0.00353    test-error:0.15805+0.00347
[88]    train-auc:0.92877+0.00170   train-error:0.12848+0.00293 test-auc:0.88760+0.00348    test-error:0.15784+0.00336
[89]    train-auc:0.92925+0.00168   train-error:0.12822+0.00280 test-auc:0.88770+0.00357    test-error:0.15805+0.00365
[90]    train-auc:0.92955+0.00162   train-error:0.12764+0.00314 test-auc:0.88780+0.00361    test-error:0.15749+0.00369
[91]    train-auc:0.92986+0.00176   train-error:0.12732+0.00306 test-auc:0.88789+0.00363    test-error:0.15728+0.00408
[92]    train-auc:0.93029+0.00168   train-error:0.12692+0.00266 test-auc:0.88805+0.00364    test-error:0.15763+0.00388
[93]    train-auc:0.93049+0.00166   train-error:0.12673+0.00269 test-auc:0.88812+0.00359    test-error:0.15784+0.00354
[94]    train-auc:0.93089+0.00157   train-error:0.12632+0.00278 test-auc:0.88828+0.00360    test-error:0.15735+0.00387
[95]    train-auc:0.93134+0.00150   train-error:0.12587+0.00270 test-auc:0.88841+0.00373    test-error:0.15756+0.00378
[96]    train-auc:0.93165+0.00156   train-error:0.12555+0.00268 test-auc:0.88859+0.00370    test-error:0.15763+0.00388
[97]    train-auc:0.93201+0.00156   train-error:0.12513+0.00286 test-auc:0.88865+0.00362    test-error:0.15756+0.00412
[98]    train-auc:0.93224+0.00155   train-error:0.12508+0.00271 test-auc:0.88867+0.00359    test-error:0.15728+0.00424
[99]    train-auc:0.93247+0.00148   train-error:0.12461+0.00257 test-auc:0.88874+0.00368    test-error:0.15679+0.00387</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div id="results" class="cell" data-outputid="993383b8-ac57-486a-cafc-90bf5a61449c" data-execution_count="15">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, precision_recall_curve, average_precision_score</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print CV results</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cross-validation results:"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best AUC: </span><span class="sc">{</span>cv_results[<span class="st">'test-auc-mean'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_results[<span class="st">'test-auc-std'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Error: </span><span class="sc">{</span>cv_results[<span class="st">'test-error-mean'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_results[<span class="st">'test-error-std'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training final model..."</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> xgb.train(params, dtrain, num_round)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(dtest)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>y_pred_binary <span class="op">=</span> (y_pred <span class="op">&gt;</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate additional metrics</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, y_pred_binary).ravel()</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> tn <span class="op">+</span> fp <span class="op">+</span> fn <span class="op">+</span> tp</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Metrics</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> total</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn)  <span class="co"># Also known as True Positive Rate</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> (tn <span class="op">+</span> fp)  <span class="co"># True Negative Rate</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> (fn <span class="op">+</span> tp)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (precision <span class="op">*</span> recall) <span class="op">/</span> (precision <span class="op">+</span> recall)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional Metrics</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>prevalence <span class="op">=</span> (tp <span class="op">+</span> fn) <span class="op">/</span> total</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>positive_predictive_value <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)  <span class="co"># Same as precision</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>negative_predictive_value <span class="op">=</span> tn <span class="op">/</span> (tn <span class="op">+</span> fn)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>positive_likelihood_ratio <span class="op">=</span> recall <span class="op">/</span> false_positive_rate</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>negative_likelihood_ratio <span class="op">=</span> false_negative_rate <span class="op">/</span> specificity</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Comprehensive Model Performance Metrics:"</span>)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision (Positive Predictive Value): </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall (Sensitivity/True Positive Rate): </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Specificity (True Negative Rate): </span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positive Rate: </span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negative Rate: </span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"F1 Score: </span><span class="sc">{</span>f1<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Prevalence: </span><span class="sc">{</span>prevalence<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Negative Predictive Value: </span><span class="sc">{</span>negative_predictive_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Positive Likelihood Ratio: </span><span class="sc">{</span>positive_likelihood_ratio<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Negative Likelihood Ratio: </span><span class="sc">{</span>negative_likelihood_ratio<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_binary))</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Confusion Matrix:"</span>)</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test, y_pred_binary)</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ROC AUC Score: </span><span class="sc">{</span>roc_auc_score(y_test, y_pred)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC and PR curves</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>fpr, tpr, _ <span class="op">=</span> roc_curve(y_test, y_pred)</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>precision_curve, recall_curve, _ <span class="op">=</span> precision_recall_curve(y_test, y_pred)</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>average_precision <span class="op">=</span> average_precision_score(y_test, y_pred)</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance analysis</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> final_model.get_score(importance_type<span class="op">=</span><span class="st">'weight'</span>)</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(importance.items()), columns<span class="op">=</span>[<span class="st">'Feature'</span>, <span class="st">'Importance'</span>])</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> importance_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 10 Most Important Features:"</span>)</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(importance_df)</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: ROC Curve</span></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, color<span class="op">=</span><span class="st">'darkorange'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'ROC curve (AUC = </span><span class="sc">{</span>roc_auc_score(y_test, y_pred)<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'navy'</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Receiver Operating Characteristic (ROC) Curve'</span>)</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Precision-Recall Curve</span></span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a>plt.plot(recall_curve, precision_curve, color<span class="op">=</span><span class="st">'blue'</span>, lw<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="ss">f'Precision-Recall curve (AP = </span><span class="sc">{</span>average_precision<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Recall'</span>)</span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Precision'</span>)</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Precision-Recall Curve'</span>)</span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower left"</span>)</span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: Feature Importance</span></span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, data<span class="op">=</span>importance_df.head(<span class="dv">10</span>), palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 10 Feature Importances'</span>)</span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 4: Confusion Matrix</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Label'</span>)</span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Label'</span>)</span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Print calibration metrics</span></span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.calibration <span class="im">import</span> calibration_curve</span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a>prob_true, prob_pred <span class="op">=</span> calibration_curve(y_test, y_pred, n_bins<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot calibration curve</span></span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a>plt.plot(prob_pred, prob_true, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mean Predicted Probability'</span>)</span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Probability'</span>)</span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Calibration Plot'</span>)</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-validation results:
Best AUC: 0.8887 (+/- 0.0034)
Best Error: 0.1568 (+/- 0.0013)

Training final model...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [05:33:24] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Comprehensive Model Performance Metrics:

Accuracy: 0.8443
Precision (Positive Predictive Value): 0.8764
Recall (Sensitivity/True Positive Rate): 0.9254
Specificity (True Negative Rate): 0.5886
False Positive Rate: 0.4114
False Negative Rate: 0.0746
F1 Score: 0.9002
Prevalence: 0.7593
Negative Predictive Value: 0.7143
Positive Likelihood Ratio: 2.2492
Negative Likelihood Ratio: 0.1268

Classification Report:
              precision    recall  f1-score   support

           0       0.71      0.59      0.65       858
           1       0.88      0.93      0.90      2706

    accuracy                           0.84      3564
   macro avg       0.80      0.76      0.77      3564
weighted avg       0.84      0.84      0.84      3564


Confusion Matrix:
[[ 505  353]
 [ 202 2504]]

ROC AUC Score: 0.8916

Top 10 Most Important Features:
     Feature  Importance
26  prdtocc1       234.0
25  prdtind1       223.0
12    prtage       176.0
6       gtco       134.0
15   peeduca       127.0
23  pehractt       126.0
0   hefaminc       111.0
24  peio1cow       108.0
19  pemntvty        91.0
3      HUBUS        77.0
11     perrp        75.0
1   hrnumhou        67.0
22  pehruslt        66.0
21  prinuyer        58.0
20  pefntvty        55.0
17  prfamrel        51.0
5     gtcbsa        47.0
27   pternwa        44.0
28    prchld        43.0
14     pesex        42.0
10     gtcsa        36.0
29  prnmchld        36.0
16  ptdtrace        32.0
18  penatvty        28.0
2    hrhtype        27.0
4   gestfips        26.0
8   gtindvpc        24.0
13  pemaritl        22.0
9   gtcbsasz        14.0
7   gtcbsast        12.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x='Importance', y='Feature', data=importance_df.head(10), palette='viridis')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/results-output-5.png" id="results-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/results-output-6.png" id="results-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div id="probit" class="cell" data-outputid="f1c8a0be-7378-47ce-f029-58f95ebd05b4" data-execution_count="16">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Fitting Probit model for effect sizes and p-values..."</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We add a constant for statsmodels</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>X_train_final.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>y_train.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>X_train_probit <span class="op">=</span> sm.add_constant(X_train_final)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>probit_model <span class="op">=</span> sm.Probit(y_train, X_train_probit)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>probit_results <span class="op">=</span> probit_model.fit()</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Probit Model Summary:"</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(probit_results.summary())</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally compute marginal effects</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Marginal Effects (Probit):"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>marginal_effects <span class="op">=</span> probit_results.get_margeff()</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(marginal_effects.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fitting Probit model for effect sizes and p-values...
Optimization terminated successfully.
         Current function value: 0.427806
         Iterations 6

Probit Model Summary:
                          Probit Regression Results                           
==============================================================================
Dep. Variable:                 pttlwk   No. Observations:                14255
Model:                         Probit   Df Residuals:                    14224
Method:                           MLE   Df Model:                           30
Date:                Sun, 02 Feb 2025   Pseudo R-squ.:                  0.2249
Time:                        05:33:30   Log-Likelihood:                -6098.4
converged:                       True   LL-Null:                       -7868.1
Covariance Type:            nonrobust   LLR p-value:                     0.000
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          2.2208      0.902      2.463      0.014       0.454       3.988
hefaminc      -0.0550      0.006     -9.743      0.000      -0.066      -0.044
hrnumhou       0.0550      0.014      3.858      0.000       0.027       0.083
hrhtype        0.0036      0.014      0.266      0.790      -0.023       0.030
HUBUS          0.2808      0.031      9.035      0.000       0.220       0.342
gestfips       0.1019      0.022      4.544      0.000       0.058       0.146
gtcbsa     -3.337e-06   1.93e-06     -1.729      0.084   -7.12e-06    4.46e-07
gtco        -8.21e-05      0.001     -0.151      0.880      -0.001       0.001
gtcbsast       0.1007      0.032      3.175      0.001       0.039       0.163
gtindvpc       0.0028      0.041      0.069      0.945      -0.077       0.083
gtcbsasz       0.0894      0.020      4.542      0.000       0.051       0.128
gtcsa         -0.0012      0.000     -6.856      0.000      -0.002      -0.001
perrp          0.0007      0.005      0.137      0.891      -0.009       0.011
prtage         0.0054      0.001      4.802      0.000       0.003       0.008
pemaritl       0.0251      0.011      2.260      0.024       0.003       0.047
pesex         -0.1291      0.027     -4.695      0.000      -0.183      -0.075
peeduca       -0.1358      0.007    -19.551      0.000      -0.149      -0.122
ptdtrace      -0.0401      0.011     -3.645      0.000      -0.062      -0.019
prfamrel       0.1337      0.022      5.951      0.000       0.090       0.178
penatvty    7.458e-05      0.000      0.246      0.805      -0.001       0.001
pemntvty       0.0010      0.000      3.370      0.001       0.000       0.002
pefntvty      -0.0003      0.000     -1.054      0.292      -0.001       0.000
prinuyer       0.0044      0.003      1.526      0.127      -0.001       0.010
pehruslt       0.0014      0.001      1.061      0.289      -0.001       0.004
pehractt      -0.0056      0.002     -3.699      0.000      -0.009      -0.003
peio1cow      -0.1141      0.012     -9.191      0.000      -0.138      -0.090
prdtind1       0.0064      0.001      5.538      0.000       0.004       0.009
prdtocc1       0.0539      0.002     24.860      0.000       0.050       0.058
pternwa    -1.354e-07   9.27e-08     -1.461      0.144   -3.17e-07    4.62e-08
prchld         0.0042      0.010      0.407      0.684      -0.016       0.024
prnmchld      -0.0282      0.033     -0.859      0.390      -0.092       0.036
==============================================================================

Marginal Effects (Probit):
       Probit Marginal Effects       
=====================================
Dep. Variable:                 pttlwk
Method:                          dydx
At:                           overall
==============================================================================
                dy/dx    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
hefaminc      -0.0132      0.001     -9.814      0.000      -0.016      -0.011
hrnumhou       0.0133      0.003      3.862      0.000       0.007       0.020
hrhtype        0.0009      0.003      0.266      0.790      -0.006       0.007
HUBUS          0.0676      0.007      9.111      0.000       0.053       0.082
gestfips       0.0245      0.005      4.554      0.000       0.014       0.035
gtcbsa     -8.035e-07   4.65e-07     -1.729      0.084   -1.71e-06    1.07e-07
gtco       -1.977e-05      0.000     -0.151      0.880      -0.000       0.000
gtcbsast       0.0242      0.008      3.179      0.001       0.009       0.039
gtindvpc       0.0007      0.010      0.069      0.945      -0.019       0.020
gtcbsasz       0.0215      0.005      4.552      0.000       0.012       0.031
gtcsa         -0.0003   4.27e-05     -6.884      0.000      -0.000      -0.000
perrp          0.0002      0.001      0.137      0.891      -0.002       0.003
prtage         0.0013      0.000      4.810      0.000       0.001       0.002
pemaritl       0.0060      0.003      2.261      0.024       0.001       0.011
pesex         -0.0311      0.007     -4.706      0.000      -0.044      -0.018
peeduca       -0.0327      0.002    -20.201      0.000      -0.036      -0.030
ptdtrace      -0.0097      0.003     -3.649      0.000      -0.015      -0.004
prfamrel       0.0322      0.005      5.969      0.000       0.022       0.043
penatvty    1.796e-05   7.29e-05      0.246      0.805      -0.000       0.000
pemntvty       0.0002   7.18e-05      3.374      0.001       0.000       0.000
pefntvty   -7.247e-05   6.87e-05     -1.054      0.292      -0.000    6.23e-05
prinuyer       0.0011      0.001      1.527      0.127      -0.000       0.002
pehruslt       0.0003      0.000      1.061      0.289      -0.000       0.001
pehractt      -0.0014      0.000     -3.705      0.000      -0.002      -0.001
peio1cow      -0.0275      0.003     -9.272      0.000      -0.033      -0.022
prdtind1       0.0015      0.000      5.555      0.000       0.001       0.002
prdtocc1       0.0130      0.000     26.497      0.000       0.012       0.014
pternwa    -3.261e-08   2.23e-08     -1.462      0.144   -7.63e-08    1.11e-08
prchld         0.0010      0.002      0.407      0.684      -0.004       0.006
prnmchld      -0.0068      0.008     -0.860      0.390      -0.022       0.009
==============================================================================</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div id="shap" class="cell" data-outputid="da051c1b-c0f3-446b-d639-d5ba8bde61d4" data-execution_count="17">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Calculating and plotting SHAP values for XGBoost model..."</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(final_model)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_test_final)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SHAP Beeswarm (summary) Plot ---</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating SHAP Beeswarm plot..."</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_test_final)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SHAP Bar Plot of Mean Absolute SHAP Values ---</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating SHAP Bar plot..."</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_test_final, plot_type<span class="op">=</span><span class="st">"bar"</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) If you want to examine a single observation or more advanced plots:</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co"># idx_to_explain = 0  # index in X_test_final</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co"># shap.force_plot(</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     explainer.expected_value,</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     shap_values[idx_to_explain,:],</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     X_test_final.iloc[idx_to_explain,:],</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     matplotlib=True</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Calculating and plotting SHAP values for XGBoost model...
Generating SHAP Beeswarm plot...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/shap-output-2.png" id="shap-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating SHAP Bar plot...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/shap-output-4.png" id="shap-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [18]:</pre></div><div id="cell-35" class="cell" data-outputid="cd9fd71e-458a-439a-aacd-696d4f86fc12">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pip install bayesian-optimization</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting bayesian-optimization
  Downloading bayesian_optimization-2.0.3-py3-none-any.whl.metadata (9.0 kB)
Collecting colorama&lt;0.5.0,&gt;=0.4.6 (from bayesian-optimization)
  Downloading colorama-0.4.6-py2.py3-none-any.whl.metadata (17 kB)
Requirement already satisfied: numpy&gt;=1.25 in /usr/local/lib/python3.11/dist-packages (from bayesian-optimization) (1.26.4)
Requirement already satisfied: scikit-learn&lt;2.0.0,&gt;=1.0.0 in /usr/local/lib/python3.11/dist-packages (from bayesian-optimization) (1.6.1)
Requirement already satisfied: scipy&lt;2.0.0,&gt;=1.0.0 in /usr/local/lib/python3.11/dist-packages (from bayesian-optimization) (1.13.1)
Requirement already satisfied: joblib&gt;=1.2.0 in /usr/local/lib/python3.11/dist-packages (from scikit-learn&lt;2.0.0,&gt;=1.0.0-&gt;bayesian-optimization) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /usr/local/lib/python3.11/dist-packages (from scikit-learn&lt;2.0.0,&gt;=1.0.0-&gt;bayesian-optimization) (3.5.0)
Downloading bayesian_optimization-2.0.3-py3-none-any.whl (31 kB)
Downloading colorama-0.4.6-py2.py3-none-any.whl (25 kB)
Installing collected packages: colorama, bayesian-optimization
Successfully installed bayesian-optimization-2.0.3 colorama-0.4.6</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [19]:</pre></div><div id="cell-36" class="cell" data-outputid="439f915e-5848-4caf-ef0f-cb79ac578403">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># from sklearn.model_selection import train_test_split</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from sklearn.preprocessing import StandardScaler</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from sklearn.feature_selection import SelectKBest, f_classif</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from sklearn.metrics import accuracy_score, classification_report, confusion_matrix, roc_auc_score</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># from statsmodels.stats.outliers_influence import variance_inflation_factor</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># import xgboost as xgb</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># import seaborn as sns</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co"># from imblearn.over_sampling import SMOTE</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co"># from bayes_opt import BayesianOptimization</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load and prepare data</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co"># filtered_df = pd.read_csv("filtered_df.csv")</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co"># X = filtered_df.drop(['pttlwk', 'pxtlwkhr', 'pttlwkhr', 'pxtlwk'], axis=1)</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co"># y = filtered_df['pttlwk']</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert labels from 1.0/2.0 to 0/1</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="co"># y = (y == 2.0).astype(int)</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Split the data first</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reset indices to ensure alignment</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train = X_train.reset_index(drop=True)</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test = X_test.reset_index(drop=True)</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train = y_train.reset_index(drop=True)</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a><span class="co"># y_test = y_test.reset_index(drop=True)</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # Scale the features</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Scaling features...")</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="co"># scaler = StandardScaler()</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_scaled = pd.DataFrame(scaler.fit_transform(X_train), columns=X_train.columns)</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_scaled = pd.DataFrame(scaler.transform(X_test), columns=X_test.columns)</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a><span class="co"># # Feature selection</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Performing feature selection...")</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="co"># selector = SelectKBest(f_classif, k=50)</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_reduced = selector.fit_transform(X_train_scaled, y_train)</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_reduced = selector.transform(X_test_scaled)</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get selected feature names</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="co"># selected_features = X_train.columns[selector.get_support()].tolist()</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_reduced = pd.DataFrame(X_train_reduced, columns=selected_features)</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_reduced = pd.DataFrame(X_test_reduced, columns=selected_features)</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate VIF</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Performing multicollinearity analysis...")</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a><span class="co"># vif_data = pd.DataFrame()</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a><span class="co"># vif_data["Feature"] = selected_features</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a><span class="co"># vif_data["VIF"] = [variance_inflation_factor(X_train_reduced.values, i)</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a><span class="co">#                    for i in range(X_train_reduced.shape[1])]</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nVIF Results:")</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a><span class="co"># print(vif_data)</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="co"># # Drop high VIF features</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a><span class="co"># high_vif_features = vif_data[vif_data["VIF"] &gt; 10]["Feature"].tolist()</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"\nDropping features with high VIF: {high_vif_features}")</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_vif = X_train_reduced.drop(columns=high_vif_features)</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_vif = X_test_reduced.drop(columns=high_vif_features)</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a><span class="co"># # Outlier removal</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nPerforming outlier analysis...")</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a><span class="co"># z_scores = np.abs((X_train_vif - X_train_vif.mean()) / X_train_vif.std())</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = 3</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a><span class="co"># non_outliers = (z_scores &lt; threshold).all(axis=1)</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a><span class="co"># # Make sure indices align before filtering</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_clean = X_train_vif[non_outliers].reset_index(drop=True)</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train_clean = pd.Series(y_train.values[non_outliers]).reset_index(drop=True)</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a><span class="co"># # Apply SMOTE for class imbalance</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nApplying SMOTE for class balancing...")</span></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a><span class="co"># smote = SMOTE(random_state=42)</span></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_balanced, y_train_balanced = smote.fit_resample(X_train_clean, y_train_clean)</span></span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to numpy arrays for XGBoost</span></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_balanced = np.array(X_train_balanced)</span></span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train_balanced = np.array(y_train_balanced)</span></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_vif_array = np.array(X_test_vif)</span></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a><span class="co"># # Function for Bayesian Optimization</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a><span class="co"># def xgb_evaluate(max_depth, learning_rate, n_estimators, subsample, colsample_bytree):</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a><span class="co">#     params = {</span></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a><span class="co">#         'max_depth': int(max_depth),</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a><span class="co">#         'learning_rate': learning_rate,</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="co">#         'n_estimators': int(n_estimators),</span></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a><span class="co">#         'subsample': subsample,</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a><span class="co">#         'colsample_bytree': colsample_bytree,</span></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a><span class="co">#         'objective': 'binary:logistic',</span></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a><span class="co">#         'eval_metric': 'logloss',</span></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="co">#         'seed': 42</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Convert to DMatrix format</span></span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     dtrain = xgb.DMatrix(X_train_balanced, label=y_train_balanced)</span></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a><span class="co">#     dtest = xgb.DMatrix(X_test_vif_array)</span></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Train model</span></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a><span class="co">#     model = xgb.train(params, dtrain, num_boost_round=int(n_estimators))</span></span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Make predictions</span></span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a><span class="co">#     y_pred = (model.predict(dtest) &gt; 0.5).astype(int)</span></span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a><span class="co">#     return accuracy_score(y_test, y_pred)</span></span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a><span class="co"># # Initialize Bayesian Optimization</span></span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nStarting Bayesian Optimization...")</span></span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a><span class="co"># optimizer = BayesianOptimization(</span></span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a><span class="co">#     f=xgb_evaluate,</span></span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a><span class="co">#     pbounds={</span></span>
<span id="cb64-113"><a href="#cb64-113" aria-hidden="true" tabindex="-1"></a><span class="co">#         'max_depth': (3, 10),</span></span>
<span id="cb64-114"><a href="#cb64-114" aria-hidden="true" tabindex="-1"></a><span class="co">#         'learning_rate': (0.01, 0.3),</span></span>
<span id="cb64-115"><a href="#cb64-115" aria-hidden="true" tabindex="-1"></a><span class="co">#         'n_estimators': (50, 200),</span></span>
<span id="cb64-116"><a href="#cb64-116" aria-hidden="true" tabindex="-1"></a><span class="co">#         'subsample': (0.5, 1.0),</span></span>
<span id="cb64-117"><a href="#cb64-117" aria-hidden="true" tabindex="-1"></a><span class="co">#         'colsample_bytree': (0.5, 1.0)</span></span>
<span id="cb64-118"><a href="#cb64-118" aria-hidden="true" tabindex="-1"></a><span class="co">#     },</span></span>
<span id="cb64-119"><a href="#cb64-119" aria-hidden="true" tabindex="-1"></a><span class="co">#     random_state=42</span></span>
<span id="cb64-120"><a href="#cb64-120" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb64-121"><a href="#cb64-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-122"><a href="#cb64-122" aria-hidden="true" tabindex="-1"></a><span class="co"># # Run optimization</span></span>
<span id="cb64-123"><a href="#cb64-123" aria-hidden="true" tabindex="-1"></a><span class="co"># optimizer.maximize(</span></span>
<span id="cb64-124"><a href="#cb64-124" aria-hidden="true" tabindex="-1"></a><span class="co">#     init_points=5,</span></span>
<span id="cb64-125"><a href="#cb64-125" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_iter=15</span></span>
<span id="cb64-126"><a href="#cb64-126" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb64-127"><a href="#cb64-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-128"><a href="#cb64-128" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get best parameters</span></span>
<span id="cb64-129"><a href="#cb64-129" aria-hidden="true" tabindex="-1"></a><span class="co"># best_params = optimizer.max['params']</span></span>
<span id="cb64-130"><a href="#cb64-130" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nBest parameters found:")</span></span>
<span id="cb64-131"><a href="#cb64-131" aria-hidden="true" tabindex="-1"></a><span class="co"># print(best_params)</span></span>
<span id="cb64-132"><a href="#cb64-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-133"><a href="#cb64-133" aria-hidden="true" tabindex="-1"></a><span class="co"># # Train final model with best parameters</span></span>
<span id="cb64-134"><a href="#cb64-134" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nTraining final model with best parameters...")</span></span>
<span id="cb64-135"><a href="#cb64-135" aria-hidden="true" tabindex="-1"></a><span class="co"># final_params = {</span></span>
<span id="cb64-136"><a href="#cb64-136" aria-hidden="true" tabindex="-1"></a><span class="co">#     'max_depth': int(best_params['max_depth']),</span></span>
<span id="cb64-137"><a href="#cb64-137" aria-hidden="true" tabindex="-1"></a><span class="co">#     'learning_rate': best_params['learning_rate'],</span></span>
<span id="cb64-138"><a href="#cb64-138" aria-hidden="true" tabindex="-1"></a><span class="co">#     'n_estimators': int(best_params['n_estimators']),</span></span>
<span id="cb64-139"><a href="#cb64-139" aria-hidden="true" tabindex="-1"></a><span class="co">#     'subsample': best_params['subsample'],</span></span>
<span id="cb64-140"><a href="#cb64-140" aria-hidden="true" tabindex="-1"></a><span class="co">#     'colsample_bytree': best_params['colsample_bytree'],</span></span>
<span id="cb64-141"><a href="#cb64-141" aria-hidden="true" tabindex="-1"></a><span class="co">#     'objective': 'binary:logistic',</span></span>
<span id="cb64-142"><a href="#cb64-142" aria-hidden="true" tabindex="-1"></a><span class="co">#     'eval_metric': 'logloss'</span></span>
<span id="cb64-143"><a href="#cb64-143" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb64-144"><a href="#cb64-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-145"><a href="#cb64-145" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create final DMatrix objects</span></span>
<span id="cb64-146"><a href="#cb64-146" aria-hidden="true" tabindex="-1"></a><span class="co"># dtrain = xgb.DMatrix(X_train_balanced, label=y_train_balanced)</span></span>
<span id="cb64-147"><a href="#cb64-147" aria-hidden="true" tabindex="-1"></a><span class="co"># dtest = xgb.DMatrix(X_test_vif_array)</span></span>
<span id="cb64-148"><a href="#cb64-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-149"><a href="#cb64-149" aria-hidden="true" tabindex="-1"></a><span class="co"># # Train final model</span></span>
<span id="cb64-150"><a href="#cb64-150" aria-hidden="true" tabindex="-1"></a><span class="co"># final_model = xgb.train(final_params, dtrain)</span></span>
<span id="cb64-151"><a href="#cb64-151" aria-hidden="true" tabindex="-1"></a><span class="co"># y_pred = (final_model.predict(dtest) &gt; 0.5).astype(int)</span></span>
<span id="cb64-152"><a href="#cb64-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-153"><a href="#cb64-153" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print results</span></span>
<span id="cb64-154"><a href="#cb64-154" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nModel Performance Metrics:")</span></span>
<span id="cb64-155"><a href="#cb64-155" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nClassification Report:")</span></span>
<span id="cb64-156"><a href="#cb64-156" aria-hidden="true" tabindex="-1"></a><span class="co"># print(classification_report(y_test, y_pred))</span></span>
<span id="cb64-157"><a href="#cb64-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-158"><a href="#cb64-158" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot confusion matrix</span></span>
<span id="cb64-159"><a href="#cb64-159" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(8, 6))</span></span>
<span id="cb64-160"><a href="#cb64-160" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.heatmap(confusion_matrix(y_test, y_pred), annot=True, fmt='d', cmap='Blues')</span></span>
<span id="cb64-161"><a href="#cb64-161" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('XGBoost Confusion Matrix')</span></span>
<span id="cb64-162"><a href="#cb64-162" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('Predicted')</span></span>
<span id="cb64-163"><a href="#cb64-163" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Actual')</span></span>
<span id="cb64-164"><a href="#cb64-164" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb64-165"><a href="#cb64-165" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb64-166"><a href="#cb64-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-167"><a href="#cb64-167" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot optimization history</span></span>
<span id="cb64-168"><a href="#cb64-168" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(10, 5))</span></span>
<span id="cb64-169"><a href="#cb64-169" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(range(len(optimizer.space.target)), optimizer.space.target, '-o')</span></span>
<span id="cb64-170"><a href="#cb64-170" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('Iteration')</span></span>
<span id="cb64-171"><a href="#cb64-171" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Model Accuracy')</span></span>
<span id="cb64-172"><a href="#cb64-172" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Bayesian Optimization History')</span></span>
<span id="cb64-173"><a href="#cb64-173" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axvline(x=5, color='r', linestyle='--', label='End of Random Search')</span></span>
<span id="cb64-174"><a href="#cb64-174" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.legend()</span></span>
<span id="cb64-175"><a href="#cb64-175" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb64-176"><a href="#cb64-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-177"><a href="#cb64-177" aria-hidden="true" tabindex="-1"></a><span class="co"># # Feature importance</span></span>
<span id="cb64-178"><a href="#cb64-178" aria-hidden="true" tabindex="-1"></a><span class="co"># importance = final_model.get_score(importance_type='weight')</span></span>
<span id="cb64-179"><a href="#cb64-179" aria-hidden="true" tabindex="-1"></a><span class="co"># importance_df = pd.DataFrame(list(importance.items()), columns=['Feature', 'Importance'])</span></span>
<span id="cb64-180"><a href="#cb64-180" aria-hidden="true" tabindex="-1"></a><span class="co"># importance_df = importance_df.sort_values(by='Importance', ascending=False)</span></span>
<span id="cb64-181"><a href="#cb64-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-182"><a href="#cb64-182" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(12, 6))</span></span>
<span id="cb64-183"><a href="#cb64-183" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.barplot(x='Importance', y='Feature', data=importance_df.head(10), palette='viridis')</span></span>
<span id="cb64-184"><a href="#cb64-184" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Top 10 Feature Importances')</span></span>
<span id="cb64-185"><a href="#cb64-185" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('Importance')</span></span>
<span id="cb64-186"><a href="#cb64-186" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Feature')</span></span>
<span id="cb64-187"><a href="#cb64-187" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb64-188"><a href="#cb64-188" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Scaling features...
Performing feature selection...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/sklearn/feature_selection/_univariate_selection.py:111: UserWarning: Features [  7   8   9  16  17  24  26  32  42  53  66  69  71  72  76  77  78  79
  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97
 107 109 115 160 173 174 175 176 177 178 179 180 181 182 195 196 197 198
 199 200 201 202 203 204 205 206 207 208 211 212 213 214 215 218 219 220
 221 222 223 224 225 238 239 240 241 242 243 244 245 246 247 248 249 250
 251 255 256 257 258 259 260 261 263 264 267 270 271 272 274 291] are constant.
  warnings.warn("Features %s are constant." % constant_features_idx, UserWarning)
/usr/local/lib/python3.11/dist-packages/sklearn/feature_selection/_univariate_selection.py:112: RuntimeWarning: invalid value encountered in divide
  f = msb / msw</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing multicollinearity analysis...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/statsmodels/stats/outliers_influence.py:197: RuntimeWarning: divide by zero encountered in scalar divide
  vif = 1. / (1. - r_squared_i)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
VIF Results:
      Feature         VIF
0    OCCURNUM         inf
1       HUBUS    3.104158
2     HUBUSL1    3.040994
3    hehousut    1.053932
4    hrnumhou    1.613758
5    hefaminc    1.366005
6    hxfaminc    1.041178
7    PULINENO         inf
8    PUIO1MFG    1.200420
9    PUSLFPRX    1.730368
10      perrp    3.068334
11   pemaritl  450.277952
12    pxrace1    1.239154
13   pehspnon    3.504174
14    peeduca    1.865216
15   pespouse   10.326498
16   pemntvty    5.751234
17   pefntvty    5.795244
18   pedipged    1.620007
19      pecyc    1.261176
20     pepar1    6.813180
21     pepar2    7.247503
22  pepar1typ    8.514617
23  pepar2typ    8.421113
24   prmarsta  547.232596
25    prdthsp    3.022894
26   prfamrel    2.549348
27     prtage    1.580120
28    pemjnum    1.034042
29   peio1icd   11.798984
30   prmjind1   31.276246
31   prmjocc1   92.513207
32   prdtind1   41.036307
33   prdtocc1   34.092564
34    prcowpg    1.424787
35   prmjocgr   48.168168
36   peernwkp    1.834483
37    peernrt    2.477255
38   peernhro    6.011818
39   prhernal    4.562487
40   pternhly    5.746613
41   pternh1o    7.337398
42    pternwa    1.804345
43   ptio1ocd   94.423709
44     gtcbsa    2.323201
45   gtcbsast    1.893200
46   gtcbsasz    3.823655
47      gtcsa    1.555382
48   gtmetsta    2.227311
49   gtindvpc    1.217917

Dropping features with high VIF: ['OCCURNUM', 'PULINENO', 'pemaritl', 'pespouse', 'prmarsta', 'peio1icd', 'prmjind1', 'prmjocc1', 'prdtind1', 'prdtocc1', 'prmjocgr', 'ptio1ocd']

Performing outlier analysis...

Applying SMOTE for class balancing...

Starting Bayesian Optimization...
|   iter    |  target   | colsam... | learni... | max_depth | n_esti... | subsample |
-------------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:48] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 1         | 0.7732    | 0.6873    | 0.2857    | 8.124     | 139.8     | 0.578     |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:49] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 2         | 0.7872    | 0.578     | 0.02684   | 9.063     | 140.2     | 0.854     |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:51] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 3         | 0.7812    | 0.5103    | 0.2913    | 8.827     | 81.85     | 0.5909    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:53] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 4         | 0.7909    | 0.5917    | 0.09823   | 6.673     | 114.8     | 0.6456    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:54] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 5         | 0.7862    | 0.8059    | 0.05045   | 5.045     | 105.0     | 0.728     |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:54] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 6         | 0.7849    | 0.68      | 0.2875    | 6.503     | 114.9     | 0.7288    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:55] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 7         | 0.7828    | 0.7325    | 0.2368    | 6.817     | 114.4     | 0.7645    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:55] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 8         | 0.7914    | 0.8502    | 0.08643   | 6.483     | 114.6     | 0.742     |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:56] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 9         | 0.7805    | 0.6778    | 0.02618   | 6.569     | 114.7     | 0.8147    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:57] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 10        | 0.786     | 0.9038    | 0.06098   | 5.217     | 90.33     | 0.8629    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:57] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 11        | 0.7864    | 0.7456    | 0.08416   | 8.146     | 139.4     | 0.899     |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:58] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 12        | 0.785     | 0.5377    | 0.2455    | 6.267     | 95.87     | 0.6494    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:59] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 13        | 0.781     | 0.5413    | 0.2721    | 7.156     | 162.5     | 0.874     |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:06:59] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 14        | 0.7825    | 0.8641    | 0.2036    | 9.962     | 111.0     | 0.7694    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:00] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 15        | 0.7889    | 0.5668    | 0.2238    | 5.109     | 78.43     | 0.6134    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:01] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 16        | 0.7899    | 0.6357    | 0.199     | 3.435     | 162.1     | 0.9796    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:01] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 17        | 0.7862    | 0.5819    | 0.03932   | 4.665     | 186.8     | 0.8976    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:02] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 18        | 0.7827    | 0.8887    | 0.1137    | 8.863     | 190.2     | 0.5815    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:03] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 19        | 0.7818    | 0.7528    | 0.1584    | 8.54      | 99.56     | 0.9612    |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:04] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>| 20        | 0.7884    | 0.9319    | 0.1759    | 5.914     | 77.49     | 0.6407    |
=====================================================================================

Best parameters found:
{'colsample_bytree': 0.8502042604408235, 'learning_rate': 0.08643263337802379, 'max_depth': 6.482992630463139, 'n_estimators': 114.61319594670005, 'subsample': 0.7420110182828307}

Training final model with best parameters...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [00:07:05] WARNING: /workspace/src/learner.cc:740: 
Parameters: { "n_estimators" } are not used.

  warnings.warn(smsg, UserWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Performance Metrics:

Classification Report:
              precision    recall  f1-score   support

           0       0.48      0.55      0.51      1364
           1       0.86      0.82      0.84      4618

    accuracy                           0.76      5982
   macro avg       0.67      0.69      0.68      5982
weighted avg       0.77      0.76      0.77      5982
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-35-output-48.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-35-output-49.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x='Importance', y='Feature', data=importance_df.head(10), palette='viridis')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hps_cps_pums_files/figure-html/cell-35-output-51.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div id="cell-37" class="cell markdown">
<section id="pums-classification-model" class="level1">
<h1>PUMS Classification model</h1>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [21]:</pre></div><div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score, confusion_matrix, roc_auc_score</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> RFECV, SelectKBest, mutual_info_classif</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> parallel_backend</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [22]:</pre></div><div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"psam_p34.csv"</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_csv(<span class="st">"psam_p36.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [23]:</pre></div><div id="cell-40" class="cell" data-outputid="4b659734-6a5c-46f3-92b8-bb187c9a08f6">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate dataframes</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat([df, df2], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop weight columns</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>pwgtp_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> merged_df.columns <span class="cf">if</span> <span class="st">'PWGTP'</span> <span class="kw">in</span> col]</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> merged_df.drop(columns<span class="op">=</span>pwgtp_cols)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform JWTRNS (0 for values 1-10, 1 for value 11)</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>filtered_df[<span class="st">'JWTRNS'</span>] <span class="op">=</span> (filtered_df[<span class="st">'JWTRNS'</span>] <span class="op">==</span> <span class="dv">11</span>).astype(<span class="bu">int</span>)</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original shapes: df </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, df2 </span><span class="sc">{</span>df2<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Combined shape: </span><span class="sc">{</span>merged_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final shape: </span><span class="sc">{</span>filtered_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">JWTRNS distribution:"</span>)</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered_df[<span class="st">'JWTRNS'</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original shapes: df (94314, 287), df2 (206408, 287)
Combined shape: (300722, 287)
Final shape: (300722, 206)

JWTRNS distribution:
JWTRNS
0    281466
1     19256
Name: count, dtype: int64</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [24]:</pre></div><div id="cell-41" class="cell" data-outputid="0dbf2839-e03a-4c2b-f682-b60b65437402">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>filtered_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

  <div id="df-87c37d08-fff4-4753-83a6-369b1a201451" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RT</th>
<th data-quarto-table-cell-role="th">SERIALNO</th>
<th data-quarto-table-cell-role="th">DIVISION</th>
<th data-quarto-table-cell-role="th">SPORDER</th>
<th data-quarto-table-cell-role="th">PUMA</th>
<th data-quarto-table-cell-role="th">REGION</th>
<th data-quarto-table-cell-role="th">STATE</th>
<th data-quarto-table-cell-role="th">ADJINC</th>
<th data-quarto-table-cell-role="th">AGEP</th>
<th data-quarto-table-cell-role="th">CIT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">FSEMP</th>
<th data-quarto-table-cell-role="th">FSEXP</th>
<th data-quarto-table-cell-role="th">FSSIP</th>
<th data-quarto-table-cell-role="th">FSSP</th>
<th data-quarto-table-cell-role="th">FWAGP</th>
<th data-quarto-table-cell-role="th">FWKHP</th>
<th data-quarto-table-cell-role="th">FWKLP</th>
<th data-quarto-table-cell-role="th">FWKWNP</th>
<th data-quarto-table-cell-role="th">FWRKP</th>
<th data-quarto-table-cell-role="th">FYOEP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>P</td>
<td>2023GQ0000001</td>
<td>2</td>
<td>1</td>
<td>2501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>94</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>P</td>
<td>2023GQ0000002</td>
<td>2</td>
<td>1</td>
<td>603</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>18</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>P</td>
<td>2023GQ0000021</td>
<td>2</td>
<td>1</td>
<td>2103</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>78</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>P</td>
<td>2023GQ0000058</td>
<td>2</td>
<td>1</td>
<td>307</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>79</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>P</td>
<td>2023GQ0000158</td>
<td>2</td>
<td>1</td>
<td>1201</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>63</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206403</td>
<td>P</td>
<td>2023HU1459885</td>
<td>2</td>
<td>4</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>61</td>
<td>5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206404</td>
<td>P</td>
<td>2023HU1459885</td>
<td>2</td>
<td>5</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>60</td>
<td>5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206405</td>
<td>P</td>
<td>2023HU1459895</td>
<td>2</td>
<td>1</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>28</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206406</td>
<td>P</td>
<td>2023HU1459895</td>
<td>2</td>
<td>2</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>4</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206407</td>
<td>P</td>
<td>2023HU1459895</td>
<td>2</td>
<td>3</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>27</td>
<td>3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>300722 rows Ã— 206 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-87c37d08-fff4-4753-83a6-369b1a201451')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-87c37d08-fff4-4753-83a6-369b1a201451 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-87c37d08-fff4-4753-83a6-369b1a201451');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8ac9b0bd-9dd5-4450-937d-2d40eb9454a1">
  <button class="colab-df-quickchart" onclick="quickchart('df-8ac9b0bd-9dd5-4450-937d-2d40eb9454a1')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8ac9b0bd-9dd5-4450-937d-2d40eb9454a1 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_218923bb-65d6-4697-bd2f-bdbbb0dac57c">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('filtered_df')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_218923bb-65d6-4697-bd2f-bdbbb0dac57c button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('filtered_df');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [25]:</pre></div><div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div id="cell-43" class="cell" data-outputid="0296b0d6-d4bb-4bac-fb70-4508b7baf4dc">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_dataframe(df, column_threshold<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Removes columns with more than `column_threshold`% NaN values,</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co">    then removes remaining rows with NaNs.</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co">    df (pd.DataFrame): Input DataFrame</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="co">    column_threshold (float): Threshold for dropping columns (default 40%)</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame: Cleaned DataFrame</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentage of NaNs per column</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>    nan_percentage <span class="op">=</span> df.isna().mean()</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop columns exceeding the threshold</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>    cols_to_drop <span class="op">=</span> nan_percentage[nan_percentage <span class="op">&gt;</span> column_threshold].index</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>    df_cleaned <span class="op">=</span> df.drop(columns<span class="op">=</span>cols_to_drop)</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop remaining rows with NaNs</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>    df_cleaned <span class="op">=</span> df_cleaned.dropna()</span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_cleaned</span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>filtered_df_new <span class="op">=</span> clean_dataframe(filtered_df, column_threshold<span class="op">=</span><span class="fl">0.1</span>)  <span class="co"># Set 40% threshold</span></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Shape before: </span><span class="sc">{</span>filtered_df_new<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, Shape after: </span><span class="sc">{</span>filtered_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape before: (269827, 131), Shape after: (300722, 206)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [27]:</pre></div><div id="cell-44" class="cell" data-outputid="057d3e2d-8ce5-42ac-9b34-148bbb86ade5">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>filtered_df_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

  <div id="df-11d896b9-c0d1-47f8-8fd0-98db5da826f9" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RT</th>
<th data-quarto-table-cell-role="th">SERIALNO</th>
<th data-quarto-table-cell-role="th">DIVISION</th>
<th data-quarto-table-cell-role="th">SPORDER</th>
<th data-quarto-table-cell-role="th">PUMA</th>
<th data-quarto-table-cell-role="th">REGION</th>
<th data-quarto-table-cell-role="th">STATE</th>
<th data-quarto-table-cell-role="th">ADJINC</th>
<th data-quarto-table-cell-role="th">AGEP</th>
<th data-quarto-table-cell-role="th">CIT</th>
<th data-quarto-table-cell-role="th">DDRS</th>
<th data-quarto-table-cell-role="th">DEAR</th>
<th data-quarto-table-cell-role="th">DEYE</th>
<th data-quarto-table-cell-role="th">DPHY</th>
<th data-quarto-table-cell-role="th">DREM</th>
<th data-quarto-table-cell-role="th">HIMRKS</th>
<th data-quarto-table-cell-role="th">HINS1</th>
<th data-quarto-table-cell-role="th">HINS2</th>
<th data-quarto-table-cell-role="th">HINS3</th>
<th data-quarto-table-cell-role="th">HINS4</th>
<th data-quarto-table-cell-role="th">HINS5</th>
<th data-quarto-table-cell-role="th">HINS6</th>
<th data-quarto-table-cell-role="th">HINS7</th>
<th data-quarto-table-cell-role="th">JWTRNS</th>
<th data-quarto-table-cell-role="th">LANX</th>
<th data-quarto-table-cell-role="th">MAR</th>
<th data-quarto-table-cell-role="th">MIG</th>
<th data-quarto-table-cell-role="th">RELSHIPP</th>
<th data-quarto-table-cell-role="th">SCH</th>
<th data-quarto-table-cell-role="th">SCHL</th>
<th data-quarto-table-cell-role="th">SEX</th>
<th data-quarto-table-cell-role="th">ANC</th>
<th data-quarto-table-cell-role="th">ANC1P</th>
<th data-quarto-table-cell-role="th">ANC2P</th>
<th data-quarto-table-cell-role="th">DIS</th>
<th data-quarto-table-cell-role="th">HICOV</th>
<th data-quarto-table-cell-role="th">HISP</th>
<th data-quarto-table-cell-role="th">NATIVITY</th>
<th data-quarto-table-cell-role="th">OC</th>
<th data-quarto-table-cell-role="th">POBP</th>
<th data-quarto-table-cell-role="th">POVPIP</th>
<th data-quarto-table-cell-role="th">PRIVCOV</th>
<th data-quarto-table-cell-role="th">PUBCOV</th>
<th data-quarto-table-cell-role="th">QTRBIR</th>
<th data-quarto-table-cell-role="th">RAC1P</th>
<th data-quarto-table-cell-role="th">RAC2P</th>
<th data-quarto-table-cell-role="th">RAC3P</th>
<th data-quarto-table-cell-role="th">RACAIAN</th>
<th data-quarto-table-cell-role="th">RACASN</th>
<th data-quarto-table-cell-role="th">RACBLK</th>
<th data-quarto-table-cell-role="th">RACNH</th>
<th data-quarto-table-cell-role="th">RACNUM</th>
<th data-quarto-table-cell-role="th">RACPI</th>
<th data-quarto-table-cell-role="th">RACSOR</th>
<th data-quarto-table-cell-role="th">RACWHT</th>
<th data-quarto-table-cell-role="th">RC</th>
<th data-quarto-table-cell-role="th">WAOB</th>
<th data-quarto-table-cell-role="th">FAGEP</th>
<th data-quarto-table-cell-role="th">FANCP</th>
<th data-quarto-table-cell-role="th">FCITP</th>
<th data-quarto-table-cell-role="th">FCITWP</th>
<th data-quarto-table-cell-role="th">FCOWP</th>
<th data-quarto-table-cell-role="th">FDDRSP</th>
<th data-quarto-table-cell-role="th">FDEARP</th>
<th data-quarto-table-cell-role="th">FDEYEP</th>
<th data-quarto-table-cell-role="th">FDISP</th>
<th data-quarto-table-cell-role="th">FDOUTP</th>
<th data-quarto-table-cell-role="th">FDPHYP</th>
<th data-quarto-table-cell-role="th">FDRATP</th>
<th data-quarto-table-cell-role="th">FDRATXP</th>
<th data-quarto-table-cell-role="th">FDREMP</th>
<th data-quarto-table-cell-role="th">FENGP</th>
<th data-quarto-table-cell-role="th">FESRP</th>
<th data-quarto-table-cell-role="th">FFERP</th>
<th data-quarto-table-cell-role="th">FFODP</th>
<th data-quarto-table-cell-role="th">FGCLP</th>
<th data-quarto-table-cell-role="th">FGCMP</th>
<th data-quarto-table-cell-role="th">FGCRP</th>
<th data-quarto-table-cell-role="th">FHICOVP</th>
<th data-quarto-table-cell-role="th">FHIMRKSP</th>
<th data-quarto-table-cell-role="th">FHINS1P</th>
<th data-quarto-table-cell-role="th">FHINS2P</th>
<th data-quarto-table-cell-role="th">FHINS3P</th>
<th data-quarto-table-cell-role="th">FHINS4P</th>
<th data-quarto-table-cell-role="th">FHINS5P</th>
<th data-quarto-table-cell-role="th">FHINS6P</th>
<th data-quarto-table-cell-role="th">FHINS7P</th>
<th data-quarto-table-cell-role="th">FHISP</th>
<th data-quarto-table-cell-role="th">FINDP</th>
<th data-quarto-table-cell-role="th">FINTP</th>
<th data-quarto-table-cell-role="th">FJWDP</th>
<th data-quarto-table-cell-role="th">FJWMNP</th>
<th data-quarto-table-cell-role="th">FJWRIP</th>
<th data-quarto-table-cell-role="th">FJWTRNSP</th>
<th data-quarto-table-cell-role="th">FLANP</th>
<th data-quarto-table-cell-role="th">FLANXP</th>
<th data-quarto-table-cell-role="th">FMARP</th>
<th data-quarto-table-cell-role="th">FMARHDP</th>
<th data-quarto-table-cell-role="th">FMARHMP</th>
<th data-quarto-table-cell-role="th">FMARHTP</th>
<th data-quarto-table-cell-role="th">FMARHWP</th>
<th data-quarto-table-cell-role="th">FMARHYP</th>
<th data-quarto-table-cell-role="th">FMIGP</th>
<th data-quarto-table-cell-role="th">FMIGSP</th>
<th data-quarto-table-cell-role="th">FMILPP</th>
<th data-quarto-table-cell-role="th">FMILSP</th>
<th data-quarto-table-cell-role="th">FOCCP</th>
<th data-quarto-table-cell-role="th">FOIP</th>
<th data-quarto-table-cell-role="th">FPAP</th>
<th data-quarto-table-cell-role="th">FPERNP</th>
<th data-quarto-table-cell-role="th">FPINCP</th>
<th data-quarto-table-cell-role="th">FPOBP</th>
<th data-quarto-table-cell-role="th">FPOWSP</th>
<th data-quarto-table-cell-role="th">FPRIVCOVP</th>
<th data-quarto-table-cell-role="th">FPUBCOVP</th>
<th data-quarto-table-cell-role="th">FRACP</th>
<th data-quarto-table-cell-role="th">FRELSHIPP</th>
<th data-quarto-table-cell-role="th">FRETP</th>
<th data-quarto-table-cell-role="th">FSCHGP</th>
<th data-quarto-table-cell-role="th">FSCHLP</th>
<th data-quarto-table-cell-role="th">FSCHP</th>
<th data-quarto-table-cell-role="th">FSEMP</th>
<th data-quarto-table-cell-role="th">FSEXP</th>
<th data-quarto-table-cell-role="th">FSSIP</th>
<th data-quarto-table-cell-role="th">FSSP</th>
<th data-quarto-table-cell-role="th">FWAGP</th>
<th data-quarto-table-cell-role="th">FWKHP</th>
<th data-quarto-table-cell-role="th">FWKLP</th>
<th data-quarto-table-cell-role="th">FWKWNP</th>
<th data-quarto-table-cell-role="th">FWRKP</th>
<th data-quarto-table-cell-role="th">FYOEP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3350</td>
<td>P</td>
<td>2023HU0000023</td>
<td>2</td>
<td>1</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>61</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2.0</td>
<td>1</td>
<td>1.0</td>
<td>20</td>
<td>1.0</td>
<td>22.0</td>
<td>1</td>
<td>2</td>
<td>51</td>
<td>148</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3351</td>
<td>P</td>
<td>2023HU0000023</td>
<td>2</td>
<td>2</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>57</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>2.0</td>
<td>1</td>
<td>1.0</td>
<td>21</td>
<td>1.0</td>
<td>21.0</td>
<td>2</td>
<td>2</td>
<td>51</td>
<td>50</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3352</td>
<td>P</td>
<td>2023HU0000023</td>
<td>2</td>
<td>3</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>25</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>2.0</td>
<td>5</td>
<td>1.0</td>
<td>25</td>
<td>1.0</td>
<td>21.0</td>
<td>1</td>
<td>2</td>
<td>51</td>
<td>50</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3353</td>
<td>P</td>
<td>2023HU0000023</td>
<td>2</td>
<td>4</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>22</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>1.0</td>
<td>5</td>
<td>3.0</td>
<td>25</td>
<td>1.0</td>
<td>21.0</td>
<td>2</td>
<td>2</td>
<td>51</td>
<td>50</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3354</td>
<td>P</td>
<td>2023HU0000229</td>
<td>2</td>
<td>1</td>
<td>602</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>36</td>
<td>5</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>1.0</td>
<td>5</td>
<td>1.0</td>
<td>20</td>
<td>1.0</td>
<td>22.0</td>
<td>1</td>
<td>1</td>
<td>785</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
<td>247</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>6</td>
<td>4014</td>
<td>9</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206401</td>
<td>P</td>
<td>2023HU1459885</td>
<td>2</td>
<td>2</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>37</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>1.0</td>
<td>1</td>
<td>3.0</td>
<td>21</td>
<td>1.0</td>
<td>15.0</td>
<td>2</td>
<td>1</td>
<td>706</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>36</td>
<td>269.0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>4000</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206403</td>
<td>P</td>
<td>2023HU1459885</td>
<td>2</td>
<td>4</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>61</td>
<td>5</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>1.0</td>
<td>1</td>
<td>3.0</td>
<td>29</td>
<td>1.0</td>
<td>1.0</td>
<td>1</td>
<td>1</td>
<td>706</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
<td>207</td>
<td>269.0</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>6</td>
<td>4000</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206404</td>
<td>P</td>
<td>2023HU1459885</td>
<td>2</td>
<td>5</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>60</td>
<td>5</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>2.0</td>
<td>1</td>
<td>3.0</td>
<td>29</td>
<td>1.0</td>
<td>1.0</td>
<td>2</td>
<td>1</td>
<td>706</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
<td>207</td>
<td>269.0</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>6</td>
<td>4000</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206405</td>
<td>P</td>
<td>2023HU1459895</td>
<td>2</td>
<td>1</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>28</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>1.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>2.0</td>
<td>5</td>
<td>1.0</td>
<td>20</td>
<td>1.0</td>
<td>17.0</td>
<td>2</td>
<td>1</td>
<td>261</td>
<td>999</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0.0</td>
<td>36</td>
<td>284.0</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206407</td>
<td>P</td>
<td>2023HU1459895</td>
<td>2</td>
<td>3</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>27</td>
<td>3</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>2.0</td>
<td>5</td>
<td>3.0</td>
<td>34</td>
<td>1.0</td>
<td>16.0</td>
<td>2</td>
<td>2</td>
<td>195</td>
<td>22</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>138</td>
<td>259.0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>269827 rows Ã— 131 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-11d896b9-c0d1-47f8-8fd0-98db5da826f9')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-11d896b9-c0d1-47f8-8fd0-98db5da826f9 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-11d896b9-c0d1-47f8-8fd0-98db5da826f9');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-f233c49a-c7e4-4148-a4df-ddf6335d815b">
  <button class="colab-df-quickchart" onclick="quickchart('df-f233c49a-c7e4-4148-a4df-ddf6335d815b')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-f233c49a-c7e4-4148-a4df-ddf6335d815b button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_d7117f40-d941-4a29-a43a-e769e11d9b02">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('filtered_df_new')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_d7117f40-d941-4a29-a43a-e769e11d9b02 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('filtered_df_new');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [28]:</pre></div><div id="cell-45" class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> filtered_df_new.drop([<span class="st">'RT'</span>,<span class="st">'SERIALNO'</span>,<span class="st">'JWTRNS'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> filtered_df_new[<span class="st">'JWTRNS'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [29]:</pre></div><div id="cell-46" class="cell" data-outputid="c3c4120c-c2b0-4097-afca-2c3d9b5a1e72">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

  <div id="df-16eee36c-8620-4ee7-802d-7aa9659314f1" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DIVISION</th>
<th data-quarto-table-cell-role="th">SPORDER</th>
<th data-quarto-table-cell-role="th">PUMA</th>
<th data-quarto-table-cell-role="th">REGION</th>
<th data-quarto-table-cell-role="th">STATE</th>
<th data-quarto-table-cell-role="th">ADJINC</th>
<th data-quarto-table-cell-role="th">AGEP</th>
<th data-quarto-table-cell-role="th">CIT</th>
<th data-quarto-table-cell-role="th">DDRS</th>
<th data-quarto-table-cell-role="th">DEAR</th>
<th data-quarto-table-cell-role="th">DEYE</th>
<th data-quarto-table-cell-role="th">DPHY</th>
<th data-quarto-table-cell-role="th">DREM</th>
<th data-quarto-table-cell-role="th">HIMRKS</th>
<th data-quarto-table-cell-role="th">HINS1</th>
<th data-quarto-table-cell-role="th">HINS2</th>
<th data-quarto-table-cell-role="th">HINS3</th>
<th data-quarto-table-cell-role="th">HINS4</th>
<th data-quarto-table-cell-role="th">HINS5</th>
<th data-quarto-table-cell-role="th">HINS6</th>
<th data-quarto-table-cell-role="th">HINS7</th>
<th data-quarto-table-cell-role="th">LANX</th>
<th data-quarto-table-cell-role="th">MAR</th>
<th data-quarto-table-cell-role="th">MIG</th>
<th data-quarto-table-cell-role="th">RELSHIPP</th>
<th data-quarto-table-cell-role="th">SCH</th>
<th data-quarto-table-cell-role="th">SCHL</th>
<th data-quarto-table-cell-role="th">SEX</th>
<th data-quarto-table-cell-role="th">ANC</th>
<th data-quarto-table-cell-role="th">ANC1P</th>
<th data-quarto-table-cell-role="th">ANC2P</th>
<th data-quarto-table-cell-role="th">DIS</th>
<th data-quarto-table-cell-role="th">HICOV</th>
<th data-quarto-table-cell-role="th">HISP</th>
<th data-quarto-table-cell-role="th">NATIVITY</th>
<th data-quarto-table-cell-role="th">OC</th>
<th data-quarto-table-cell-role="th">POBP</th>
<th data-quarto-table-cell-role="th">POVPIP</th>
<th data-quarto-table-cell-role="th">PRIVCOV</th>
<th data-quarto-table-cell-role="th">PUBCOV</th>
<th data-quarto-table-cell-role="th">QTRBIR</th>
<th data-quarto-table-cell-role="th">RAC1P</th>
<th data-quarto-table-cell-role="th">RAC2P</th>
<th data-quarto-table-cell-role="th">RAC3P</th>
<th data-quarto-table-cell-role="th">RACAIAN</th>
<th data-quarto-table-cell-role="th">RACASN</th>
<th data-quarto-table-cell-role="th">RACBLK</th>
<th data-quarto-table-cell-role="th">RACNH</th>
<th data-quarto-table-cell-role="th">RACNUM</th>
<th data-quarto-table-cell-role="th">RACPI</th>
<th data-quarto-table-cell-role="th">RACSOR</th>
<th data-quarto-table-cell-role="th">RACWHT</th>
<th data-quarto-table-cell-role="th">RC</th>
<th data-quarto-table-cell-role="th">WAOB</th>
<th data-quarto-table-cell-role="th">FAGEP</th>
<th data-quarto-table-cell-role="th">FANCP</th>
<th data-quarto-table-cell-role="th">FCITP</th>
<th data-quarto-table-cell-role="th">FCITWP</th>
<th data-quarto-table-cell-role="th">FCOWP</th>
<th data-quarto-table-cell-role="th">FDDRSP</th>
<th data-quarto-table-cell-role="th">FDEARP</th>
<th data-quarto-table-cell-role="th">FDEYEP</th>
<th data-quarto-table-cell-role="th">FDISP</th>
<th data-quarto-table-cell-role="th">FDOUTP</th>
<th data-quarto-table-cell-role="th">FDPHYP</th>
<th data-quarto-table-cell-role="th">FDRATP</th>
<th data-quarto-table-cell-role="th">FDRATXP</th>
<th data-quarto-table-cell-role="th">FDREMP</th>
<th data-quarto-table-cell-role="th">FENGP</th>
<th data-quarto-table-cell-role="th">FESRP</th>
<th data-quarto-table-cell-role="th">FFERP</th>
<th data-quarto-table-cell-role="th">FFODP</th>
<th data-quarto-table-cell-role="th">FGCLP</th>
<th data-quarto-table-cell-role="th">FGCMP</th>
<th data-quarto-table-cell-role="th">FGCRP</th>
<th data-quarto-table-cell-role="th">FHICOVP</th>
<th data-quarto-table-cell-role="th">FHIMRKSP</th>
<th data-quarto-table-cell-role="th">FHINS1P</th>
<th data-quarto-table-cell-role="th">FHINS2P</th>
<th data-quarto-table-cell-role="th">FHINS3P</th>
<th data-quarto-table-cell-role="th">FHINS4P</th>
<th data-quarto-table-cell-role="th">FHINS5P</th>
<th data-quarto-table-cell-role="th">FHINS6P</th>
<th data-quarto-table-cell-role="th">FHINS7P</th>
<th data-quarto-table-cell-role="th">FHISP</th>
<th data-quarto-table-cell-role="th">FINDP</th>
<th data-quarto-table-cell-role="th">FINTP</th>
<th data-quarto-table-cell-role="th">FJWDP</th>
<th data-quarto-table-cell-role="th">FJWMNP</th>
<th data-quarto-table-cell-role="th">FJWRIP</th>
<th data-quarto-table-cell-role="th">FJWTRNSP</th>
<th data-quarto-table-cell-role="th">FLANP</th>
<th data-quarto-table-cell-role="th">FLANXP</th>
<th data-quarto-table-cell-role="th">FMARP</th>
<th data-quarto-table-cell-role="th">FMARHDP</th>
<th data-quarto-table-cell-role="th">FMARHMP</th>
<th data-quarto-table-cell-role="th">FMARHTP</th>
<th data-quarto-table-cell-role="th">FMARHWP</th>
<th data-quarto-table-cell-role="th">FMARHYP</th>
<th data-quarto-table-cell-role="th">FMIGP</th>
<th data-quarto-table-cell-role="th">FMIGSP</th>
<th data-quarto-table-cell-role="th">FMILPP</th>
<th data-quarto-table-cell-role="th">FMILSP</th>
<th data-quarto-table-cell-role="th">FOCCP</th>
<th data-quarto-table-cell-role="th">FOIP</th>
<th data-quarto-table-cell-role="th">FPAP</th>
<th data-quarto-table-cell-role="th">FPERNP</th>
<th data-quarto-table-cell-role="th">FPINCP</th>
<th data-quarto-table-cell-role="th">FPOBP</th>
<th data-quarto-table-cell-role="th">FPOWSP</th>
<th data-quarto-table-cell-role="th">FPRIVCOVP</th>
<th data-quarto-table-cell-role="th">FPUBCOVP</th>
<th data-quarto-table-cell-role="th">FRACP</th>
<th data-quarto-table-cell-role="th">FRELSHIPP</th>
<th data-quarto-table-cell-role="th">FRETP</th>
<th data-quarto-table-cell-role="th">FSCHGP</th>
<th data-quarto-table-cell-role="th">FSCHLP</th>
<th data-quarto-table-cell-role="th">FSCHP</th>
<th data-quarto-table-cell-role="th">FSEMP</th>
<th data-quarto-table-cell-role="th">FSEXP</th>
<th data-quarto-table-cell-role="th">FSSIP</th>
<th data-quarto-table-cell-role="th">FSSP</th>
<th data-quarto-table-cell-role="th">FWAGP</th>
<th data-quarto-table-cell-role="th">FWKHP</th>
<th data-quarto-table-cell-role="th">FWKLP</th>
<th data-quarto-table-cell-role="th">FWKWNP</th>
<th data-quarto-table-cell-role="th">FWRKP</th>
<th data-quarto-table-cell-role="th">FYOEP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3350</td>
<td>2</td>
<td>1</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>61</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>1</td>
<td>1.0</td>
<td>20</td>
<td>1.0</td>
<td>22.0</td>
<td>1</td>
<td>2</td>
<td>51</td>
<td>148</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3351</td>
<td>2</td>
<td>2</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>57</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>1</td>
<td>1.0</td>
<td>21</td>
<td>1.0</td>
<td>21.0</td>
<td>2</td>
<td>2</td>
<td>51</td>
<td>50</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3352</td>
<td>2</td>
<td>3</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>25</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>5</td>
<td>1.0</td>
<td>25</td>
<td>1.0</td>
<td>21.0</td>
<td>1</td>
<td>2</td>
<td>51</td>
<td>50</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3353</td>
<td>2</td>
<td>4</td>
<td>1501</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>22</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1.0</td>
<td>5</td>
<td>3.0</td>
<td>25</td>
<td>1.0</td>
<td>21.0</td>
<td>2</td>
<td>2</td>
<td>51</td>
<td>50</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>34</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3354</td>
<td>2</td>
<td>1</td>
<td>602</td>
<td>1</td>
<td>34</td>
<td>1019518</td>
<td>36</td>
<td>5</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1.0</td>
<td>5</td>
<td>1.0</td>
<td>20</td>
<td>1.0</td>
<td>22.0</td>
<td>1</td>
<td>1</td>
<td>785</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
<td>247</td>
<td>501.0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>6</td>
<td>4014</td>
<td>9</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206401</td>
<td>2</td>
<td>2</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>37</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1.0</td>
<td>1</td>
<td>3.0</td>
<td>21</td>
<td>1.0</td>
<td>15.0</td>
<td>2</td>
<td>1</td>
<td>706</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>36</td>
<td>269.0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>4000</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206403</td>
<td>2</td>
<td>4</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>61</td>
<td>5</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1.0</td>
<td>1</td>
<td>3.0</td>
<td>29</td>
<td>1.0</td>
<td>1.0</td>
<td>1</td>
<td>1</td>
<td>706</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
<td>207</td>
<td>269.0</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>6</td>
<td>4000</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206404</td>
<td>2</td>
<td>5</td>
<td>4503</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>60</td>
<td>5</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>1</td>
<td>3.0</td>
<td>29</td>
<td>1.0</td>
<td>1.0</td>
<td>2</td>
<td>1</td>
<td>706</td>
<td>999</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
<td>207</td>
<td>269.0</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>6</td>
<td>4000</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206405</td>
<td>2</td>
<td>1</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>28</td>
<td>1</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>1.0</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>5</td>
<td>1.0</td>
<td>20</td>
<td>1.0</td>
<td>17.0</td>
<td>2</td>
<td>1</td>
<td>261</td>
<td>999</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0.0</td>
<td>36</td>
<td>284.0</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">206407</td>
<td>2</td>
<td>3</td>
<td>2201</td>
<td>1</td>
<td>36</td>
<td>1019518</td>
<td>27</td>
<td>3</td>
<td>2.0</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>2.0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2.0</td>
<td>5</td>
<td>3.0</td>
<td>34</td>
<td>1.0</td>
<td>16.0</td>
<td>2</td>
<td>2</td>
<td>195</td>
<td>22</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>138</td>
<td>259.0</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>269827 rows Ã— 128 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-16eee36c-8620-4ee7-802d-7aa9659314f1')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-16eee36c-8620-4ee7-802d-7aa9659314f1 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-16eee36c-8620-4ee7-802d-7aa9659314f1');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-5526ca08-1401-48b9-8185-1b3f323a8bec">
  <button class="colab-df-quickchart" onclick="quickchart('df-5526ca08-1401-48b9-8185-1b3f323a8bec')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-5526ca08-1401-48b9-8185-1b3f323a8bec button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_8be0736b-3ffc-457a-ae55-0fbbb26ded22">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('X')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_8be0736b-3ffc-457a-ae55-0fbbb26ded22 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('X');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [30]:</pre></div><div id="cell-47" class="cell" data-outputid="b1ec8029-4f30-42eb-9893-848de8741add">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing initial feature selection..."</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>selector <span class="op">=</span> SelectKBest(mutual_info_classif, k<span class="op">=</span><span class="dv">50</span>)  <span class="co"># Keep top 50 features</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>X_reduced <span class="op">=</span> selector.fit_transform(X, y)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> X.columns[selector.get_support(indices<span class="op">=</span><span class="va">True</span>)]</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 50 features selected."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing initial feature selection...
Top 50 features selected.</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [31]:</pre></div><div id="cell-48" class="cell" data-outputid="87ee91c1-c9f6-487a-ab43-150e6eb0b228">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with reduced features for VIF and further steps</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(X_reduced, columns<span class="op">=</span>selected_features)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_vif(df):</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    vif_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    vif_data[<span class="st">"Feature"</span>] <span class="op">=</span> df.columns</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    vif_data[<span class="st">"VIF"</span>] <span class="op">=</span> [variance_inflation_factor(df.values, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df.shape[<span class="dv">1</span>])]</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vif_data</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIF for all features</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing multicollinearity analysis..."</span>)</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>vif_data <span class="op">=</span> calculate_vif(X)</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VIF Results:"</span>)</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vif_data)</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop features with high VIF (&gt;10)</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>high_vif_features <span class="op">=</span> vif_data[vif_data[<span class="st">"VIF"</span>] <span class="op">&gt;</span> <span class="dv">10</span>][<span class="st">"Feature"</span>].tolist()</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dropping features with high VIF: </span><span class="sc">{</span>high_vif_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop(columns<span class="op">=</span>high_vif_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing multicollinearity analysis...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.11/dist-packages/statsmodels/regression/linear_model.py:1782: RuntimeWarning: divide by zero encountered in scalar divide
  return 1 - self.ssr/self.centered_tss</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VIF Results:
     Feature        VIF
0   DIVISION   0.000000
1    SPORDER   2.869733
2     REGION   0.000000
3      STATE   1.027068
4     ADJINC   0.000000
5       AGEP   5.067786
6        CIT  29.190795
7       DDRS   1.456627
8       DEAR   1.486323
9       DEYE   1.213110
10      DPHY   2.468438
11      DREM   1.734816
12     HINS1   8.008333
13     HINS2   3.408955
14     HINS3   6.312910
15     HINS4   4.484648
16     HINS5   1.151792
17     HINS6   1.137001
18     HINS7   1.008831
19      LANX   2.060376
20       MAR   1.973975
21       MIG   1.039952
22  RELSHIPP   2.605885
23       SCH   2.207972
24      SCHL   2.225258
25       SEX   1.025181
26       ANC   1.598622
27     ANC2P   1.236159
28       DIS   4.025628
29     HICOV   1.757198
30      HISP   1.516314
31  NATIVITY  20.347995
32        OC  10.232945
33      POBP   6.726340
34    POVPIP   1.522446
35   PRIVCOV  10.015254
36    PUBCOV   9.146812
37    QTRBIR   1.000340
38     RAC1P  22.747278
39     RAC2P  27.650659
40    RACNUM   3.897050
41    RACWHT   3.066811
42        RC  12.664471
43      WAOB   6.800092
44   FHICOVP  28.691421
45     FJWDP   2.857438
46    FJWMNP   4.163790
47    FPINCP   1.455027
48    FPOWSP   3.514944
49  FPUBCOVP  28.977155
Dropping features with high VIF: ['CIT', 'NATIVITY', 'OC', 'PRIVCOV', 'RAC1P', 'RAC2P', 'RC', 'FHICOVP', 'FPUBCOVP']</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [32]:</pre></div><div id="cell-49" class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [33]:</pre></div><div id="cell-50" class="cell" data-outputid="4d77972e-d1e6-4933-eb2e-4abe642b302b">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive Feature Elimination</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing Recursive Feature Elimination..."</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> parallel_backend(<span class="st">'threading'</span>):</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    rf_model <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    rfecv <span class="op">=</span> RFECV(estimator<span class="op">=</span>rf_model, step<span class="op">=</span><span class="dv">1</span>, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    rfecv.fit(X_train, y_train)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get selected features from RFE</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>rfe_selected_features <span class="op">=</span> rfecv.support_</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>X_train_final <span class="op">=</span> X_train.iloc[:, rfe_selected_features]</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>X_test_final <span class="op">=</span> X_test.iloc[:, rfe_selected_features]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing Recursive Feature Elimination with XGBoost (GPU)...</code></pre>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-15-9179f3fec620&gt;</span> in <span class="ansi-cyan-fg">&lt;cell line: 0&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">     56</span>         n_jobs<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg ansi-bold">     57</span>     )
<span class="ansi-green-fg">---&gt; 58</span><span class="ansi-red-fg">     </span>rfecv<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span>X_train<span class="ansi-blue-fg">,</span> y_train<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     59</span> 
<span class="ansi-green-fg ansi-bold">     60</span> <span class="ansi-red-fg"># Get selected features</span>

<span class="ansi-green-fg">/usr/local/lib/python3.11/dist-packages/sklearn/utils/validation.py</span> in <span class="ansi-cyan-fg">inner_f</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">     61</span>             extra_args <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> len<span class="ansi-blue-fg">(</span>all_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     62</span>             <span class="ansi-green-fg">if</span> extra_args <span class="ansi-blue-fg">&lt;=</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 63</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">     64</span> 
<span class="ansi-green-fg ansi-bold">     65</span>             <span class="ansi-red-fg"># extra_args &gt; 0</span>

<span class="ansi-green-fg">/usr/local/lib/python3.11/dist-packages/sklearn/base.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(estimator, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">   1387</span>                 )
<span class="ansi-green-fg ansi-bold">   1388</span>             ):
<span class="ansi-green-fg">-&gt; 1389</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> fit_method<span class="ansi-blue-fg">(</span>estimator<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   1390</span> 
<span class="ansi-green-fg ansi-bold">   1391</span>         <span class="ansi-green-fg">return</span> wrapper

<span class="ansi-green-fg">/usr/local/lib/python3.11/dist-packages/sklearn/feature_selection/_rfe.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, X, y, groups, **params)</span>
<span class="ansi-green-fg ansi-bold">    830</span> 
<span class="ansi-green-fg ansi-bold">    831</span>         <span class="ansi-red-fg"># Initialization</span>
<span class="ansi-green-fg">--&gt; 832</span><span class="ansi-red-fg">         </span>cv <span class="ansi-blue-fg">=</span> check_cv<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>cv<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> classifier<span class="ansi-blue-fg">=</span>is_classifier<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>estimator<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    833</span>         scorer <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_get_scorer<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    834</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.11/dist-packages/sklearn/base.py</span> in <span class="ansi-cyan-fg">is_classifier</span><span class="ansi-blue-fg">(estimator)</span>
<span class="ansi-green-fg ansi-bold">   1235</span>         <span class="ansi-green-fg">return</span> getattr<span class="ansi-blue-fg">(</span>estimator<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">"_estimator_type"</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">"classifier"</span>
<span class="ansi-green-fg ansi-bold">   1236</span> 
<span class="ansi-green-fg">-&gt; 1237</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> get_tags<span class="ansi-blue-fg">(</span>estimator<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>estimator_type <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">"classifier"</span>
<span class="ansi-green-fg ansi-bold">   1238</span> 
<span class="ansi-green-fg ansi-bold">   1239</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.11/dist-packages/sklearn/utils/_tags.py</span> in <span class="ansi-cyan-fg">get_tags</span><span class="ansi-blue-fg">(estimator)</span>
<span class="ansi-green-fg ansi-bold">    428</span>         <span class="ansi-green-fg">for</span> klass <span class="ansi-green-fg">in</span> reversed<span class="ansi-blue-fg">(</span>type<span class="ansi-blue-fg">(</span>estimator<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>mro<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    429</span>             <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">"__sklearn_tags__"</span> <span class="ansi-green-fg">in</span> vars<span class="ansi-blue-fg">(</span>klass<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 430</span><span class="ansi-red-fg">                 </span>sklearn_tags_provider<span class="ansi-blue-fg">[</span>klass<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> klass<span class="ansi-blue-fg">.</span>__sklearn_tags__<span class="ansi-blue-fg">(</span>estimator<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># type: ignore[attr-defined]</span>
<span class="ansi-green-fg ansi-bold">    431</span>                 class_order<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>klass<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    432</span>             <span class="ansi-green-fg">elif</span> <span class="ansi-blue-fg">"_more_tags"</span> <span class="ansi-green-fg">in</span> vars<span class="ansi-blue-fg">(</span>klass<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.11/dist-packages/sklearn/base.py</span> in <span class="ansi-cyan-fg">__sklearn_tags__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    538</span> 
<span class="ansi-green-fg ansi-bold">    539</span>     <span class="ansi-green-fg">def</span> __sklearn_tags__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 540</span><span class="ansi-red-fg">         </span>tags <span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__sklearn_tags__<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    541</span>         tags<span class="ansi-blue-fg">.</span>estimator_type <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"classifier"</span>
<span class="ansi-green-fg ansi-bold">    542</span>         tags<span class="ansi-blue-fg">.</span>classifier_tags <span class="ansi-blue-fg">=</span> ClassifierTags<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: 'super' object has no attribute '__sklearn_tags__'</pre>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [34]:</pre></div><div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Outlier Analysis</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Performing outlier analysis...")</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z_scores = np.abs((X_train_final - np.mean(X_train_final, axis=0)) / np.std(X_train_final, axis=0))</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = 3</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co"># non_outliers = (z_scores &lt; threshold).all(axis=1)</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co"># outlier_percentage = 100 * (1 - np.sum(non_outliers) / len(non_outliers))</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Percentage of outliers removed: {outlier_percentage:.2f}%")</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Align indices before filtering</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_final = X_train_final[non_outliers].reset_index(drop=True)</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train = y_train.iloc[X_train.index[non_outliers]].reset_index(drop=True) # Use iloc and original X_train index to align</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [35]:</pre></div><div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>X_train_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [36]:</pre></div><div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DMatrix format for XGBoost</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>dtrain <span class="op">=</span> xgb.DMatrix(X_train_final, label<span class="op">=</span>y_train)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> xgb.DMatrix(X_test_final, label<span class="op">=</span>y_test)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define XGBoost parameters</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'objective'</span>: <span class="st">'binary:logistic'</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'eval_metric'</span>: <span class="st">'logloss'</span>,</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: <span class="dv">5</span>,</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: <span class="fl">0.1</span>,</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: <span class="dv">100</span>,</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'seed'</span>: <span class="dv">42</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validation</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performing cross-validation..."</span>)</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>num_round <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> xgb.cv(</span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>    params,</span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>    dtrain,</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>    num_boost_round<span class="op">=</span>num_round,</span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>    nfold<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">'auc'</span>, <span class="st">'error'</span>],</span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>    early_stopping_rounds<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>    verbose_eval<span class="op">=</span><span class="va">True</span></span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [37]:</pre></div><div id="cell-54" class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, precision_recall_curve, average_precision_score</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print CV results</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cross-validation results:"</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best AUC: </span><span class="sc">{</span>cv_results[<span class="st">'test-auc-mean'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_results[<span class="st">'test-auc-std'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Error: </span><span class="sc">{</span>cv_results[<span class="st">'test-error-mean'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_results[<span class="st">'test-error-std'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training final model..."</span>)</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> xgb.train(params, dtrain, num_round)</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(dtest)</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>y_pred_binary <span class="op">=</span> (y_pred <span class="op">&gt;</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate additional metrics</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, y_pred_binary).ravel()</span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> tn <span class="op">+</span> fp <span class="op">+</span> fn <span class="op">+</span> tp</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Metrics</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> total</span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)</span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn)  <span class="co"># Also known as True Positive Rate</span></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> (tn <span class="op">+</span> fp)  <span class="co"># True Negative Rate</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn)</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> (fn <span class="op">+</span> tp)</span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (precision <span class="op">*</span> recall) <span class="op">/</span> (precision <span class="op">+</span> recall)</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional Metrics</span></span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>prevalence <span class="op">=</span> (tp <span class="op">+</span> fn) <span class="op">/</span> total</span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a>positive_predictive_value <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)  <span class="co"># Same as precision</span></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>negative_predictive_value <span class="op">=</span> tn <span class="op">/</span> (tn <span class="op">+</span> fn)</span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>positive_likelihood_ratio <span class="op">=</span> recall <span class="op">/</span> false_positive_rate</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>negative_likelihood_ratio <span class="op">=</span> false_negative_rate <span class="op">/</span> specificity</span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Comprehensive Model Performance Metrics:"</span>)</span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision (Positive Predictive Value): </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall (Sensitivity/True Positive Rate): </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-41"><a href="#cb136-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Specificity (True Negative Rate): </span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-42"><a href="#cb136-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positive Rate: </span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-43"><a href="#cb136-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negative Rate: </span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-44"><a href="#cb136-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"F1 Score: </span><span class="sc">{</span>f1<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-45"><a href="#cb136-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Prevalence: </span><span class="sc">{</span>prevalence<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-46"><a href="#cb136-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Negative Predictive Value: </span><span class="sc">{</span>negative_predictive_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-47"><a href="#cb136-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Positive Likelihood Ratio: </span><span class="sc">{</span>positive_likelihood_ratio<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-48"><a href="#cb136-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Negative Likelihood Ratio: </span><span class="sc">{</span>negative_likelihood_ratio<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-49"><a href="#cb136-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-50"><a href="#cb136-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb136-51"><a href="#cb136-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_binary))</span>
<span id="cb136-52"><a href="#cb136-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-53"><a href="#cb136-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Confusion Matrix:"</span>)</span>
<span id="cb136-54"><a href="#cb136-54" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test, y_pred_binary)</span>
<span id="cb136-55"><a href="#cb136-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span>
<span id="cb136-56"><a href="#cb136-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-57"><a href="#cb136-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ROC AUC Score: </span><span class="sc">{</span>roc_auc_score(y_test, y_pred)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb136-58"><a href="#cb136-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-59"><a href="#cb136-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC and PR curves</span></span>
<span id="cb136-60"><a href="#cb136-60" aria-hidden="true" tabindex="-1"></a>fpr, tpr, _ <span class="op">=</span> roc_curve(y_test, y_pred)</span>
<span id="cb136-61"><a href="#cb136-61" aria-hidden="true" tabindex="-1"></a>precision_curve, recall_curve, _ <span class="op">=</span> precision_recall_curve(y_test, y_pred)</span>
<span id="cb136-62"><a href="#cb136-62" aria-hidden="true" tabindex="-1"></a>average_precision <span class="op">=</span> average_precision_score(y_test, y_pred)</span>
<span id="cb136-63"><a href="#cb136-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-64"><a href="#cb136-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance analysis</span></span>
<span id="cb136-65"><a href="#cb136-65" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> final_model.get_score(importance_type<span class="op">=</span><span class="st">'weight'</span>)</span>
<span id="cb136-66"><a href="#cb136-66" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(importance.items()), columns<span class="op">=</span>[<span class="st">'Feature'</span>, <span class="st">'Importance'</span>])</span>
<span id="cb136-67"><a href="#cb136-67" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> importance_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb136-68"><a href="#cb136-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-69"><a href="#cb136-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 10 Most Important Features:"</span>)</span>
<span id="cb136-70"><a href="#cb136-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(importance_df)</span>
<span id="cb136-71"><a href="#cb136-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-72"><a href="#cb136-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb136-73"><a href="#cb136-73" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb136-74"><a href="#cb136-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-75"><a href="#cb136-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: ROC Curve</span></span>
<span id="cb136-76"><a href="#cb136-76" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb136-77"><a href="#cb136-77" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, color<span class="op">=</span><span class="st">'darkorange'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'ROC curve (AUC = </span><span class="sc">{</span>roc_auc_score(y_test, y_pred)<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb136-78"><a href="#cb136-78" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'navy'</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb136-79"><a href="#cb136-79" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb136-80"><a href="#cb136-80" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb136-81"><a href="#cb136-81" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb136-82"><a href="#cb136-82" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb136-83"><a href="#cb136-83" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Receiver Operating Characteristic (ROC) Curve'</span>)</span>
<span id="cb136-84"><a href="#cb136-84" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb136-85"><a href="#cb136-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-86"><a href="#cb136-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Precision-Recall Curve</span></span>
<span id="cb136-87"><a href="#cb136-87" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb136-88"><a href="#cb136-88" aria-hidden="true" tabindex="-1"></a>plt.plot(recall_curve, precision_curve, color<span class="op">=</span><span class="st">'blue'</span>, lw<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb136-89"><a href="#cb136-89" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="ss">f'Precision-Recall curve (AP = </span><span class="sc">{</span>average_precision<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb136-90"><a href="#cb136-90" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Recall'</span>)</span>
<span id="cb136-91"><a href="#cb136-91" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Precision'</span>)</span>
<span id="cb136-92"><a href="#cb136-92" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Precision-Recall Curve'</span>)</span>
<span id="cb136-93"><a href="#cb136-93" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower left"</span>)</span>
<span id="cb136-94"><a href="#cb136-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-95"><a href="#cb136-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: Feature Importance</span></span>
<span id="cb136-96"><a href="#cb136-96" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb136-97"><a href="#cb136-97" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, data<span class="op">=</span>importance_df.head(<span class="dv">10</span>), palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb136-98"><a href="#cb136-98" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 10 Feature Importances'</span>)</span>
<span id="cb136-99"><a href="#cb136-99" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb136-100"><a href="#cb136-100" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb136-101"><a href="#cb136-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-102"><a href="#cb136-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 4: Confusion Matrix</span></span>
<span id="cb136-103"><a href="#cb136-103" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb136-104"><a href="#cb136-104" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb136-105"><a href="#cb136-105" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb136-106"><a href="#cb136-106" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Label'</span>)</span>
<span id="cb136-107"><a href="#cb136-107" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Label'</span>)</span>
<span id="cb136-108"><a href="#cb136-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-109"><a href="#cb136-109" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb136-110"><a href="#cb136-110" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb136-111"><a href="#cb136-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-112"><a href="#cb136-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Print calibration metrics</span></span>
<span id="cb136-113"><a href="#cb136-113" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.calibration <span class="im">import</span> calibration_curve</span>
<span id="cb136-114"><a href="#cb136-114" aria-hidden="true" tabindex="-1"></a>prob_true, prob_pred <span class="op">=</span> calibration_curve(y_test, y_pred, n_bins<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb136-115"><a href="#cb136-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-116"><a href="#cb136-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot calibration curve</span></span>
<span id="cb136-117"><a href="#cb136-117" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb136-118"><a href="#cb136-118" aria-hidden="true" tabindex="-1"></a>plt.plot(prob_pred, prob_true, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb136-119"><a href="#cb136-119" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb136-120"><a href="#cb136-120" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mean Predicted Probability'</span>)</span>
<span id="cb136-121"><a href="#cb136-121" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Probability'</span>)</span>
<span id="cb136-122"><a href="#cb136-122" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Calibration Plot'</span>)</span>
<span id="cb136-123"><a href="#cb136-123" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb136-124"><a href="#cb136-124" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [38]:</pre></div><div id="cell-55" class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Fitting Probit model for effect sizes and p-values..."</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We add a constant for statsmodels</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>X_train_final.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>y_train.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>X_train_probit <span class="op">=</span> sm.add_constant(X_train_final)</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>probit_model <span class="op">=</span> sm.Probit(y_train, X_train_probit)</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>probit_results <span class="op">=</span> probit_model.fit()</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Probit Model Summary:"</span>)</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(probit_results.summary())</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally compute marginal effects</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Marginal Effects (Probit):"</span>)</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>marginal_effects <span class="op">=</span> probit_results.get_margeff()</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(marginal_effects.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [39]:</pre></div><div id="cell-56" class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Calculating and plotting SHAP values for XGBoost model..."</span>)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(final_model)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_test_final)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SHAP Beeswarm (summary) Plot ---</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating SHAP Beeswarm plot..."</span>)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_test_final)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SHAP Bar Plot of Mean Absolute SHAP Values ---</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating SHAP Bar plot..."</span>)</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_test_final, plot_type<span class="op">=</span><span class="st">"bar"</span>)</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) If you want to examine a single observation or more advanced plots:</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="co"># idx_to_explain = 0  # index in X_test_final</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a><span class="co"># shap.force_plot(</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     explainer.expected_value,</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     shap_values[idx_to_explain,:],</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     X_test_final.iloc[idx_to_explain,:],</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     matplotlib=True</span></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>


     </main> <!-- /main -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content --> 
  
</body></html>